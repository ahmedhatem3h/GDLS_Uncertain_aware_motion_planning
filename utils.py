import math
import yaml
import os
import cv2
import pickle

import numpy as np
import matplotlib.pyplot as plt
import networkx as nx

from typing import List
from scipy.interpolate import interp1d
from scipy.spatial import ConvexHull
from shapely import Polygon
from matplotlib.path import Path
from scipy.spatial.transform import Rotation as Rot


def angle_mod(x, zero_2_2pi=False, degree=False):
    """
    Angle modulo operation
    Default angle modulo range is [-pi, pi)

    Parameters
    ----------
    x : float or array_like
        A angle or an array of angles. This array is flattened for
        the calculation. When an angle is provided, a float angle is returned.
    zero_2_2pi : bool, optional
        Change angle modulo range to [0, 2pi)
        Default is False.
    degree : bool, optional
        If True, then the given angles are assumed to be in degrees.
        Default is False.

    Returns
    -------
    ret : float or ndarray
        an angle or an array of modulated angle.

    Examples
    --------
    >>> angle_mod(-4.0)
    2.28318531

    >>> angle_mod([-4.0])
    np.array(2.28318531)

    >>> angle_mod([-150.0, 190.0, 350], degree=True)
    array([-150., -170.,  -10.])

    >>> angle_mod(-60.0, zero_2_2pi=True, degree=True)
    array([300.])

    """
    if isinstance(x, float):
        is_float = True
    else:
        is_float = False

    x = np.asarray(x).flatten()
    if degree:
        x = np.deg2rad(x)

    if zero_2_2pi:
        mod_angle = x % (2 * np.pi)
    else:
        mod_angle = (x + np.pi) % (2 * np.pi) - np.pi

    if degree:
        mod_angle = np.rad2deg(mod_angle)

    if is_float:
        return mod_angle.item()
    else:
        return mod_angle
    
class Contour:
    def __init__(self, contour, id, c = None,  scale= None, P_classes=None, p_untraversable=None):
        # self.contour = contour
        newcontour = [[],[]]
        for i in range(len(contour[0])):
            contour[0][i] = int(contour[0][i])+0.5
            contour[1][i] = int(contour[1][i])+0.5
            if i > 0:
                if contour[0][i] == contour[0][i-1] and contour[1][i] == contour[1][i-1]:
                    continue
            newcontour[0].append(contour[0][i])
            newcontour[1].append(contour[1][i])
        
        i = 0
        limit = len(newcontour[0]) 
        while i < len(newcontour[0]):
            if i > 0:
                # if the line is diagonal, put a point in the middle
                if newcontour[0][i] != newcontour[0][i-1] and newcontour[1][i] != newcontour[1][i-1]:
                    newcontour[0].insert(i, newcontour[0][i])
                    newcontour[1].insert(i, newcontour[1][i-1])
            i += 1
        self.contour = newcontour
        self.id = id
        self.polygon = Polygon(np.array(self.contour).T)
        minx, miny, maxx, maxy = self.polygon.bounds
        if c is None:
            c = [int(minx), int(miny)]
            
        self.cx = c[0]
        self.cy = c[1]
        if scale is None:
            minx, miny, maxx, maxy = self.polygon.bounds
            scale = int(max((maxx-minx),(maxy-miny)))
        self.scale = scale
        self.P_classes = P_classes
        self.p_untraversable = p_untraversable

        self.padded_polygon = self.polygon.buffer(robot_size)
        exteriorx, exteriory = self.polygon.exterior.xy
        self.path = Path(np.column_stack((exteriorx, exteriory)))
        self.centroid = self.polygon.centroid  
        # self.minx, self.miny, self.maxx, self.maxy = self.polygon.bounds
        self.sampled_points_inside = set()
        self.map_points_inside = set()
        for i in range(c[0]-3, c[0]+scale+3):
            for j in range(c[1]-3, c[1]+scale+3):
                if self.path.contains_point((i, j)):
                    self.map_points_inside.add((i, j))

class Vertex:
    def __init__(self, pos: (int, int)):
        self.pos = pos
        self.edges_and_costs = {}

    def add_edge_with_cost(self, succ: (int, int), cost: float):
        if succ != self.pos:
            self.edges_and_costs[succ] = cost

    @property
    def edges_and_c_old(self):
        return self.edges_and_costs

class Vertices:
    def __init__(self):
        self.list = []

    def add_vertex(self, v: Vertex):
        self.list.append(v)

    @property
    def vertices(self):
        return self.list

def heuristic(p: (int, int), q: (int, int)) -> float:
    """
    Helper function to compute distance between two points.
    :param p: (x,y)
    :param q: (x,y)
    :return: manhattan distance
    """
    return math.sqrt((p[0] - q[0]) ** 2 + (p[1] - q[1]) ** 2)

def get_movements_4n(x: int, y: int) -> List:
    """
    get all possible 4-connectivity movements.
    :return: list of movements with cost [(dx, dy, movement_cost)]
    """
    return [(x + 1, y + 0),
            (x + 0, y + 1),
            (x - 1, y + 0),
            (x + 0, y - 1)]

def get_movements_8n(x: int, y: int) -> List:
    """
    get all possible 8-connectivity movements.
    :return: list of movements with cost [(dx, dy, movement_cost)]
    """
    return [(x + 1, y + 0),
            (x + 0, y + 1),
            (x - 1, y + 0),
            (x + 0, y - 1),
            (x + 1, y + 1),
            (x - 1, y + 1),
            (x - 1, y - 1),
            (x + 1, y - 1)]

# Create point selection handler
class PointSelectionHandler:
    def __init__(self, ax):
        self.ax = ax
        self.cid = ax.figure.canvas.mpl_connect('button_press_event', self)
        self.selected_points = []

    def __call__(self, event):
        if event.inaxes != self.ax:
            return
        x, y = int(round(event.xdata)), int(round(event.ydata))
        self.selected_points.append((x, y))
        if len(self.selected_points) == 2:
            self.ax.figure.canvas.mpl_disconnect(self.cid)

def param_loader():
    current_dir = os.path.dirname(os.path.abspath(__file__))
    
    yaml_path = os.path.join(current_dir, 'config', 'config.yaml')
    # Read YAML file
    with open(yaml_path, 'r') as f:
        planner_params = yaml.safe_load(f)

    return planner_params
     
def map_loader(show_plot=False):

    current_dir = os.path.dirname(os.path.abspath(__file__))
    
    yaml_path = os.path.join(current_dir, '..', 'config', 'planner.yaml')
    # Read YAML file
    with open(yaml_path, 'r') as f:
        planner_params = yaml.safe_load(f)

    map_config_path = os.path.join(current_dir, '..', 'config', planner_params["map_config"])

    with open(map_config_path, 'r') as f:
        map_params = yaml.safe_load(f)

    map_path = os.path.join(current_dir,'..', 'maps',  map_params['image'])

    # Load PGM image file
    with open(map_path, 'rb') as f:
        header = f.readline().decode('utf-8')
        if header != 'P5\n':
            raise ValueError('Invalid PGM file')
        # Read the next non-comment line and parse the width and height
        while True:
            line = f.readline()
            if line.startswith(b'#'):
                continue  # skip comments
            else:
                break
        width, height = map(int, line.split())
        maxval = int(f.readline())
        data = np.frombuffer(f.read(), dtype=np.uint8)

    # Reshape data into image array
    image = np.reshape(data, (height, width))

    # Display image
    if show_plot:
        fig, ax = plt.subplots()
        ax.imshow(image, cmap='gray')
    

        
    # Find coordinates of pixels with values > occupied_thresh
    occupied_thresh = map_params['occupied_thresh']
    y_coords, x_coords = np.where(image < occupied_thresh*255)

    # Set origin and resolution
    origin = np.array(map_params['origin'])
    resolution = map_params['resolution']

    # Convert pixel coordinates to world coordinates
    world_x_coords = x_coords*resolution + origin[0]
    world_y_coords = y_coords*resolution + origin[1]
    
    if show_plot:
        plt.figure(2)
        # Plot world coordinates
        plt.scatter(world_x_coords, world_y_coords, s=1)
        plt.xlabel('x (m)')
        plt.ylabel('y (m)')
        plt.show()

    return image, origin, resolution, world_x_coords, world_y_coords

def get_start_goal_points( img, contours_objects):
    # plot the map  
    plt.figure()


    # show the map with origin at the lower left corner
    plt.imshow(img, cmap='gray')
    
    #plot all contours
    for i in range(len(contours_objects)):
        xx, yy  = contours_objects[i].polygon.exterior.xy
        #fill the contour with lower alpha
        plt.fill(xx, yy, 'r', alpha=0.5)
    
    # Select two points on the image using the mouse
    point_handler = PointSelectionHandler(plt.gca())

    plt.show()

    # Get the selected points
    p1, p2 = point_handler.selected_points

    
    return p1[0], p1[1], p2[0], p2[1]

def plot_graph(G):
    fig, ax = plt.subplots()

    # Plot G (deterministic graph)
    pos = {node: node for node in G.nodes}

    # Draw nodes with specific positions
    nx.draw_networkx_nodes(G, pos, node_color='skyblue', ax=ax, label='Nodes', node_size=30)
    # nx.draw_networkx_labels(G, pos, font_size=8)

    # Draw edges twice with different colors for edge types
    nx.draw_networkx_edges(G, pos,  edge_color='blue', width=2.0, ax=ax)

    # set axis limits
    ax.set_xlim([0, WIDTH])
    ax.set_ylim([0, HEIGHT])

def plot_graphs(G, sG):
    # Example usage:
    print("Number of nodes in G (deterministic graph):", G.number_of_nodes())
    print("Number of edges in G (deterministic graph):", G.number_of_edges())

    print("Number of nodes in sG (stochastic graph):", sG.number_of_nodes())
    print("Number of edges in sG (stochastic graph):", sG.number_of_edges())
    
    fig, ax = plt.subplots()

    # Plot G (deterministic graph)
    pos = {node: node for node in G.nodes}

    # Draw nodes with specific positions
    nx.draw_networkx_nodes(G, pos, node_color='skyblue', ax=ax, label='Nodes', node_size=8)
    # nx.draw_networkx_labels(G, pos, font_size=8)

    # Draw edges twice with different colors for edge types
    nx.draw_networkx_edges(G, pos,  edge_color='black', width=2, ax=ax, label='Deterministic')
    nx.draw_networkx_edges(sG, pos, edge_color='blue', width=2, ax=ax, label='Stochastic')

    # # plot the edge weights next to the edges
    # edge_labels = {(u, v): round(d['weight'], 2) for u, v, d in G.edges(data=True)}
    # nx.draw_networkx_edge_labels(G, pos, edge_labels=edge_labels, font_size=8, label_pos=0.5, verticalalignment='bottom', bbox=dict(facecolor='none', edgecolor='none'))

    # edge_labels = {(u, v): round(d['weight'], 2) for u, v, d in sG.edges(data=True)}
    # nx.draw_networkx_edge_labels(sG, pos, edge_labels=edge_labels, font_size=8, label_pos=0.5, verticalalignment='bottom', bbox=dict(facecolor='none', edgecolor='none'))


    # Add legend
    ax.legend()

    # flip the y-axis
    ax.invert_yaxis()

    # # set axis limits
    # ax.set_xlim([0, WIDTH])
    # ax.set_ylim([0, HEIGHT])

def get_demo_map(scale = 1):
    current_directory = os.getcwd()
    # image_path = os.path.join(current_directory, "..", 'maps', 'small_HO_P1_mask.png')
    image_path = os.path.join(current_directory, "..", 'maps', 'small_HO_P1_maks_correct_scale.png')
    img = cv2.imread(image_path, cv2.IMREAD_GRAYSCALE)
    img = cv2.resize(img, (img.shape[1]//scale, img.shape[0]//scale))

    contours_objects = []
    # coordinates = [[(265, 416), (267, 418), (267, 420), (265, 422), (264, 422), (262, 424), (262, 430), (260, 432), (260, 433), (257, 436), (257, 438), (255, 440), (255, 441), (256, 441), (257, 442), (257, 443), (255, 445), (254, 445), (253, 444), (253, 443), (251, 443), (252, 443), (253, 444), (251, 446), (250, 446), (249, 447), (248, 446), (247, 447), (244, 447), (244, 448), (242, 450), (241, 449), (240, 449), (239, 448), (238, 448), (240, 450), (240, 452), (239, 453), (236, 453), (234, 455), (234, 462), (233, 463), (233, 464), (232, 465), (232, 466), (231, 467), (230, 466), (229, 467), (227, 467), (224, 464), (224, 465), (222, 467), (221, 467), (221, 468), (223, 470), (223, 477), (225, 479), (225, 480), (226, 479), (227, 480), (227, 483), (226, 484), (226, 486), (225, 487), (223, 487), (223, 491), (222, 492), (221, 492), (221, 495), (220, 496), (219, 496), (218, 497), (217, 497), (216, 498), (217, 499), (217, 503), (218, 504), (218, 507), (217, 508), (216, 508), (215, 509), (213, 509), (212, 510), (212, 511), (211, 512), (210, 512), (210, 514), (209, 515), (209, 516), (211, 516), (212, 517), (212, 518), (213, 518), (214, 519), (215, 519), (215, 516), (216, 515), (216, 514), (217, 513), (217, 512), (218, 511), (219, 511), (219, 510), (218, 509), (219, 508), (221, 508), (222, 507), (222, 502), (223, 501), (223, 500), (222, 499), (223, 498), (225, 498), (224, 498), (222, 496), (222, 493), (223, 492), (224, 493), (224, 495), (225, 494), (226, 494), (226, 493), (227, 492), (228, 492), (228, 491), (229, 490), (230, 490), (231, 491), (231, 492), (232, 492), (233, 493), (231, 495), (232, 496), (232, 498), (233, 498), (234, 499), (234, 502), (235, 502), (236, 503), (237, 502), (239, 502), (240, 503), (240, 504), (238, 506), (238, 507), (237, 508), (237, 509), (239, 509), (242, 512), (242, 513), (245, 516), (247, 514), (248, 515), (248, 521), (247, 522), (248, 522), (249, 521), (251, 521), (252, 520), (255, 520), (256, 521), (256, 522), (255, 523), (254, 523), (254, 526), (255, 526), (256, 525), (256, 523), (257, 522), (258, 522), (259, 523), (259, 524), (261, 524), (261, 520), (260, 519), (260, 517), (261, 516), (261, 514), (262, 513), (263, 513), (264, 514), (264, 516), (265, 517), (265, 518), (264, 519), (264, 520), (265, 520), (265, 518), (266, 517), (266, 513), (265, 512), (265, 510), (264, 511), (263, 510), (263, 511), (262, 512), (260, 510), (260, 506), (261, 505), (262, 506), (262, 502), (263, 501), (264, 502), (264, 504), (265, 505), (264, 506), (265, 507), (265, 505), (266, 504), (266, 501), (267, 500), (265, 500), (264, 499), (263, 499), (262, 498), (262, 497), (263, 496), (264, 496), (265, 495), (266, 495), (268, 497), (268, 496), (269, 495), (269, 491), (268, 491), (267, 490), (267, 488), (268, 487), (269, 487), (269, 486), (271, 484), (272, 484), (273, 483), (274, 483), (275, 484), (277, 484), (277, 483), (278, 482), (278, 479), (279, 478), (280, 478), (280, 475), (279, 475), (278, 474), (278, 473), (279, 472), (281, 472), (282, 471), (282, 469), (280, 469), (279, 468), (280, 467), (280, 465), (281, 464), (282, 464), (282, 461), (283, 460), (284, 460), (283, 460), (282, 459), (282, 456), (283, 455), (284, 455), (287, 452), (289, 452), (290, 453), (290, 448), (292, 446), (293, 447), (294, 446), (294, 443), (295, 442), (295, 438), (294, 437), (294, 435), (295, 434), (295, 433), (296, 432), (296, 430), (295, 429), (294, 429), (293, 428), (292, 428), (293, 429), (293, 432), (292, 433), (291, 432), (291, 430), (290, 429), (290, 427), (291, 426), (293, 426), (294, 425), (294, 424), (292, 422), (291, 422), (291, 424), (289, 426), (288, 425), (287, 426), (286, 426), (285, 425), (285, 424), (284, 423), (282, 423), (281, 422), (281, 421), (281, 423), (280, 424), (279, 424), (278, 423), (277, 423), (276, 422), (276, 421), (277, 420), (277, 419), (276, 418), (275, 419), (274, 418), (272, 418), (271, 417), (270, 418), (269, 418), (268, 417), (267, 417), (266, 416)] , 
    # [(1774, 329), (1774, 332), (1775, 333), (1775, 334), (1774, 335), (1772, 333), (1772, 332), (1771, 332), (1771, 333), (1770, 334), (1770, 335), (1769, 336), (1767, 336), (1765, 338), (1761, 338), (1761, 339), (1760, 340), (1760, 343), (1757, 346), (1757, 347), (1758, 347), (1759, 348), (1759, 349), (1758, 350), (1756, 350), (1755, 349), (1755, 348), (1754, 348), (1752, 346), (1751, 347), (1749, 345), (1747, 345), (1747, 346), (1748, 347), (1747, 348), (1748, 349), (1748, 350), (1747, 351), (1745, 351), (1744, 352), (1745, 353), (1744, 354), (1744, 355), (1742, 357), (1740, 357), (1737, 360), (1737, 361), (1736, 362), (1735, 362), (1735, 364), (1734, 365), (1732, 363), (1731, 364), (1731, 365), (1730, 366), (1729, 365), (1729, 364), (1727, 362), (1725, 362), (1724, 363), (1722, 363), (1722, 365), (1723, 364), (1726, 364), (1727, 365), (1727, 366), (1726, 367), (1727, 367), (1728, 368), (1728, 369), (1729, 370), (1729, 372), (1728, 373), (1727, 373), (1727, 374), (1726, 375), (1725, 375), (1725, 380), (1724, 381), (1724, 384), (1725, 385), (1725, 386), (1726, 387), (1726, 388), (1729, 388), (1732, 391), (1733, 391), (1734, 392), (1734, 394), (1735, 395), (1735, 396), (1735, 395), (1736, 394), (1738, 394), (1739, 395), (1740, 394), (1741, 394), (1744, 397), (1744, 401), (1746, 401), (1747, 402), (1751, 402), (1752, 403), (1752, 407), (1753, 407), (1754, 408), (1754, 411), (1753, 412), (1752, 412), (1752, 413), (1755, 413), (1756, 412), (1757, 412), (1757, 411), (1758, 410), (1759, 411), (1759, 412), (1762, 412), (1763, 413), (1763, 414), (1767, 418), (1767, 419), (1768, 420), (1768, 421), (1769, 422), (1769, 423), (1770, 423), (1772, 425), (1772, 426), (1775, 429), (1775, 431), (1776, 432), (1776, 435), (1778, 437), (1779, 437), (1780, 438), (1780, 440), (1783, 443), (1783, 444), (1784, 444), (1785, 445), (1785, 448), (1786, 448), (1786, 447), (1785, 446), (1785, 444), (1784, 443), (1784, 442), (1783, 441), (1783, 438), (1781, 436), (1781, 434), (1780, 433), (1780, 432), (1779, 431), (1779, 429), (1778, 428), (1778, 427), (1779, 426), (1780, 426), (1781, 425), (1783, 425), (1783, 420), (1784, 419), (1785, 420), (1786, 420), (1792, 426), (1792, 427), (1792, 426), (1793, 425), (1793, 424), (1792, 423), (1792, 421), (1791, 420), (1790, 420), (1789, 419), (1790, 418), (1791, 418), (1792, 417), (1793, 418), (1794, 418), (1794, 416), (1793, 415), (1793, 412), (1793, 414), (1792, 415), (1791, 414), (1791, 412), (1790, 412), (1786, 408), (1789, 405), (1791, 405), (1793, 403), (1794, 403), (1795, 404), (1796, 404), (1796, 402), (1795, 401), (1794, 402), (1793, 402), (1792, 401), (1792, 399), (1790, 399), (1788, 397), (1788, 395), (1787, 394), (1787, 393), (1789, 391), (1790, 391), (1791, 392), (1791, 394), (1792, 393), (1793, 394), (1793, 395), (1794, 395), (1796, 397), (1797, 397), (1798, 398), (1798, 399), (1799, 400), (1799, 403), (1800, 404), (1800, 405), (1801, 404), (1805, 404), (1807, 402), (1808, 403), (1810, 403), (1810, 402), (1811, 401), (1811, 400), (1809, 400), (1808, 399), (1808, 398), (1812, 394), (1813, 394), (1815, 392), (1818, 392), (1819, 393), (1819, 395), (1821, 395), (1822, 394), (1823, 394), (1824, 395), (1824, 397), (1825, 397), (1826, 396), (1827, 396), (1829, 394), (1831, 394), (1830, 394), (1829, 393), (1829, 390), (1830, 389), (1831, 389), (1830, 388), (1830, 387), (1831, 386), (1830, 385), (1830, 384), (1831, 383), (1832, 383), (1832, 382), (1831, 381), (1831, 380), (1832, 379), (1834, 381), (1834, 380), (1832, 378), (1834, 376), (1834, 375), (1836, 373), (1837, 373), (1837, 369), (1836, 369), (1834, 371), (1833, 370), (1832, 370), (1832, 372), (1831, 373), (1826, 373), (1825, 372), (1824, 372), (1823, 371), (1823, 370), (1822, 370), (1821, 371), (1819, 369), (1817, 369), (1816, 368), (1816, 365), (1817, 364), (1819, 364), (1816, 364), (1813, 367), (1810, 367), (1809, 366), (1809, 363), (1807, 363), (1806, 362), (1806, 361), (1804, 361), (1802, 359), (1802, 357), (1800, 357), (1799, 356), (1800, 355), (1799, 354), (1799, 353), (1798, 352), (1796, 352), (1795, 351), (1795, 349), (1792, 349), (1791, 348), (1790, 348), (1789, 347), (1789, 346), (1787, 346), (1786, 345), (1786, 344), (1783, 344), (1782, 343), (1783, 342), (1782, 341), (1782, 339), (1783, 338), (1783, 337), (1782, 336), (1782, 335), (1781, 334), (1781, 333), (1780, 332), (1779, 332), (1778, 333), (1776, 333), (1775, 332), (1775, 331), (1776, 330), (1777, 330), (1775, 330)] , 
    # [(908, 512), (907, 513), (906, 513), (905, 514), (904, 514), (904, 516), (906, 518), (906, 519), (907, 519), (908, 520), (908, 521), (907, 522), (907, 524), (906, 525), (903, 525), (903, 527), (904, 528), (905, 528), (906, 529), (909, 529), (910, 530), (909, 531), (910, 532), (910, 534), (909, 535), (907, 535), (906, 536), (902, 536), (900, 534), (900, 533), (899, 533), (898, 534), (897, 533), (895, 533), (894, 534), (893, 533), (893, 528), (892, 527), (892, 525), (891, 525), (890, 524), (891, 523), (892, 523), (890, 523), (889, 522), (889, 520), (888, 520), (887, 521), (885, 519), (885, 520), (883, 522), (881, 522), (881, 525), (879, 527), (876, 527), (877, 528), (877, 529), (879, 531), (880, 531), (881, 532), (881, 534), (882, 535), (882, 539), (881, 540), (880, 540), (880, 541), (878, 543), (877, 543), (876, 542), (877, 541), (877, 539), (875, 537), (875, 536), (873, 536), (872, 537), (871, 537), (871, 538), (872, 539), (872, 540), (871, 541), (870, 541), (871, 542), (871, 544), (872, 545), (872, 547), (873, 548), (877, 548), (875, 548), (873, 546), (873, 545), (874, 544), (875, 544), (876, 543), (879, 543), (880, 544), (880, 545), (881, 544), (884, 544), (885, 543), (887, 543), (888, 544), (885, 547), (886, 547), (887, 548), (884, 551), (882, 551), (880, 549), (880, 552), (879, 553), (879, 554), (880, 553), (881, 553), (883, 555), (882, 556), (880, 556), (879, 557), (876, 554), (876, 553), (877, 552), (876, 551), (875, 551), (874, 550), (873, 550), (873, 551), (872, 552), (872, 561), (873, 562), (873, 568), (874, 569), (874, 570), (875, 571), (875, 574), (876, 575), (876, 584), (875, 585), (875, 589), (876, 590), (876, 592), (875, 593), (875, 596), (876, 597), (876, 598), (877, 599), (877, 600), (878, 600), (879, 601), (878, 602), (877, 602), (877, 604), (878, 604), (879, 605), (879, 606), (879, 605), (880, 604), (881, 605), (881, 608), (882, 607), (885, 607), (886, 608), (887, 608), (889, 610), (888, 611), (889, 612), (889, 613), (889, 611), (890, 610), (889, 609), (889, 608), (890, 607), (893, 610), (893, 611), (892, 612), (891, 612), (892, 613), (891, 614), (891, 616), (893, 616), (894, 617), (895, 617), (896, 618), (896, 619), (897, 620), (899, 620), (900, 621), (901, 620), (903, 620), (904, 621), (906, 621), (907, 620), (911, 620), (912, 621), (913, 621), (914, 622), (915, 622), (917, 620), (918, 620), (919, 621), (919, 623), (920, 622), (921, 623), (922, 622), (926, 622), (927, 621), (928, 621), (929, 622), (929, 625), (930, 626), (930, 627), (934, 627), (933, 627), (932, 626), (932, 623), (933, 622), (934, 622), (935, 621), (934, 620), (935, 619), (936, 619), (937, 620), (937, 621), (938, 621), (939, 622), (939, 623), (938, 624), (939, 624), (940, 625), (941, 625), (941, 624), (942, 623), (942, 621), (943, 620), (944, 620), (945, 619), (947, 619), (948, 618), (948, 617), (946, 617), (944, 615), (944, 614), (942, 616), (941, 615), (941, 611), (942, 610), (943, 610), (943, 609), (942, 609), (941, 608), (941, 607), (942, 606), (943, 607), (945, 607), (945, 604), (946, 603), (947, 603), (947, 602), (946, 601), (948, 599), (951, 599), (951, 598), (952, 597), (953, 598), (956, 598), (957, 597), (959, 597), (959, 594), (958, 594), (957, 593), (956, 593), (955, 594), (953, 594), (952, 593), (952, 589), (951, 589), (950, 588), (951, 587), (952, 587), (952, 586), (953, 585), (952, 585), (951, 584), (951, 582), (950, 582), (949, 581), (948, 581), (947, 580), (947, 576), (946, 576), (945, 575), (948, 572), (947, 571), (946, 571), (945, 572), (944, 571), (943, 572), (941, 572), (940, 571), (940, 568), (938, 568), (937, 567), (937, 566), (936, 565), (936, 564), (934, 564), (933, 563), (933, 561), (928, 561), (927, 562), (924, 562), (923, 561), (923, 560), (924, 559), (924, 558), (923, 558), (922, 557), (923, 556), (923, 555), (922, 554), (920, 554), (919, 553), (917, 553), (916, 552), (917, 551), (918, 551), (917, 550), (917, 549), (918, 548), (920, 548), (920, 547), (919, 547), (917, 545), (917, 547), (916, 548), (916, 549), (915, 550), (912, 547), (907, 547), (905, 545), (906, 544), (906, 543), (908, 541), (910, 541), (910, 539), (909, 538), (909, 537), (910, 536), (911, 537), (911, 536), (912, 535), (914, 535), (914, 532), (913, 533), (911, 531), (912, 530), (915, 530), (915, 525), (916, 524), (918, 524), (918, 522), (916, 520), (916, 519), (917, 518), (917, 516), (916, 516), (914, 514), (913, 515), (912, 514), (912, 513), (911, 513), (910, 512)]]


    coordinates = [[(29, 57), (27, 59), (27, 60), (24, 63), (22, 63), (21, 64), (21, 65), (20, 66), (20, 69), (21, 69), (22, 68), (23, 68), (24, 69), (25, 69), (26, 70), (27, 70), (28, 71), (29, 71), (30, 70), (30, 66), (31, 65), (31, 63), (32, 62), (32, 60), (33, 59), (33, 58), (32, 58), (31, 57)] , 
    #  [(213, 41), (212, 42), (211, 42), (209, 44), (208, 44), (208, 45), (207, 46), (206, 46), (206, 49), (205, 50), (205, 51), (206, 50), (207, 50), (208, 51), (208, 53), (206, 55), (207, 56), (208, 55), (210, 55), (211, 56), (212, 56), (213, 55), (214, 56), (214, 60), (216, 60), (217, 59), (219, 61), (220, 61), (221, 60), (221, 52), (222, 51), (222, 49), (220, 47), (220, 46), (215, 41)] , 
     [(108, 64), (107, 65), (105, 65), (104, 66), (103, 66), (102, 67), (102, 68), (100, 70), (99, 70), (99, 71), (100, 72), (100, 77), (101, 77), (102, 78), (102, 79), (103, 79), (104, 80), (105, 80), (106, 81), (103, 84), (105, 84), (106, 83), (111, 83), (111, 79), (112, 78), (113, 79), (117, 79), (116, 79), (115, 78), (116, 77), (116, 74), (115, 74), (114, 73), (114, 72), (112, 70), (112, 65), (111, 65), (110, 64)]]


    coordinates = [np.divide(np.array(coord), scale) for coord in coordinates]
    

    hulls = [ConvexHull(coord) for coord in coordinates]
    regions = []*len(hulls)
    for i in range(len(hulls)):
        regions.append([coordinates[i][s] for s in hulls[i].vertices])
        regions[i].append(regions[i][0])


    interpolated_regions = []
    for region in regions:
        interpolated_region_x = []
        interpolated_region_y = []
        for i in range(len(region) - 1):
            flag = False
            x1, y1 = region[i]
            x2, y2 = region[i+1]
            if x1 > x2:
                x1, y1, x2, y2 = x2, y2, x1, y1
                flag = True
            f = interp1d([x1, x2], [y1, y2])
            interpolated_x = np.arange(x1, x2, 0.01)
            interpolated_y = f(interpolated_x)
            if flag:
                interpolated_x = interpolated_x[::-1]
                interpolated_y = interpolated_y[::-1]
            interpolated_region_x.extend(interpolated_x)
            interpolated_region_y.extend(interpolated_y)

        interpolated_regions.append([interpolated_region_x, interpolated_region_y])

    for i, region in enumerate(interpolated_regions):
        P_classes = generate_probabilities()
        P_classes = [0, 0, 0, 0.2, 0.8, 0, 0, 0, 0, 0]
        p_untraversable = sum([P_classes[i] for i in semantic_untraversable_class_list])
                  # [0,    2,   3,        5, 6, 7, 8]

        if i == 0:
            p_untraversable = 0.75
        elif i == 1:
            p_untraversable = 0.4
        # p_untraversable = 0.5
        contour_object = Contour(region, i,  P_classes = P_classes, p_untraversable=p_untraversable)
        contours_objects.append(contour_object)

    semantic_classes = img.copy()

    final_traversability_classes = semantic_classes.copy()

    # if value of pixel a value from the untraversable classes, then it is an obstacle
    mask_obstacle = np.isin(semantic_classes, semantic_untraversable_class_list)
    final_traversability_classes[mask_obstacle.data] = 0
    final_num_classes = len(gdls_classes_cost)

    # else it is traversable and class is 1
    mask_traversable = np.logical_not(mask_obstacle)
    final_traversability_classes[mask_traversable.data] = 1


    WIDTH = final_traversability_classes.shape[1]
    HEIGHT = final_traversability_classes.shape[0]
    cost_map = np.zeros((WIDTH, HEIGHT))
    obstacle_list = []
    for x in range(WIDTH):
        for y in range(HEIGHT):
            if math.isnan(final_traversability_classes[y,x]):
                final_traversability_classes[y,x] = 1
            if final_traversability_classes[y,x] in final_untraversable_class_list:
                obstacle_list.append((x,y))
            cost_map[x,y] = gdls_classes_cost[int(final_traversability_classes[y,x])]
    # plt.imshow(final_traversability_classes, cmap='gray')
    # plt.show()
    for contour_object in contours_objects:
        P_classes = contour_object.P_classes
        new_P_classes = [0]* final_num_classes 
        p_untraversable = sum([P_classes[i] for i in semantic_untraversable_class_list])
        new_P_classes[0] = p_untraversable
        # set the rest randomly, but make sure they sum to 1
        for i in range(1, final_num_classes):
            new_P_classes[i] = np.random.random()
        traversable_sum = sum(new_P_classes[1:])
        for i in range(1, final_num_classes):
            new_P_classes[i] = (new_P_classes[i] / traversable_sum) * (1 - p_untraversable)
        contour_object.P_classes = new_P_classes
        final_traversability_classes, cost_map = update_map(cost_map, img = final_traversability_classes, contour_object = contour_object)



    return final_traversability_classes, cost_map, contours_objects, obstacle_list

def get_map(scale=1, regionsNumber = 20):
    current_directory = os.getcwd()
    image_path = os.path.join(current_directory, "..", 'maps', 'HO_P1_DEM_mask.png')
    img = cv2.imread(image_path, cv2.IMREAD_GRAYSCALE)
    # img = img[95:775, :]
    img = cv2.resize(img, (img.shape[1]//scale, img.shape[0]//scale))
    print(img.shape[0], img.shape[1])
    contours_objects = []

    # # focus only 1850 to 2050 and from 400 to 600
    # img[:375, :] = 0
    # img[575:, :] = 0
    # img[:, :1850] = 0
    # img[:, 2050:] = 0

    # # first and last are the critical regions
    # coordinates = [[(237, 477), (234, 480), (233, 480), (233, 484), (230, 487), (230, 490), (231, 491), (231, 492), (232, 492), (233, 493), (233, 499), (231, 501), (230, 501), (229, 500), (229, 501), (227, 503), (228, 504), (228, 506), (229, 505), (230, 505), (231, 506), (230, 507), (230, 508), (229, 509), (229, 510), (228, 511), (227, 510), (226, 511), (227, 511), (228, 512), (227, 513), (224, 513), (224, 514), (223, 515), (223, 517), (224, 518), (223, 519), (223, 521), (222, 522), (221, 521), (221, 520), (220, 521), (220, 523), (219, 524), (219, 526), (220, 527), (220, 528), (221, 529), (221, 531), (222, 532), (222, 534), (223, 535), (224, 534), (225, 534), (226, 535), (227, 535), (227, 534), (228, 533), (229, 534), (229, 535), (230, 536), (230, 534), (232, 532), (233, 533), (233, 536), (232, 537), (233, 537), (234, 538), (237, 535), (238, 536), (239, 536), (240, 537), (241, 537), (242, 536), (244, 536), (244, 535), (246, 533), (247, 533), (248, 532), (248, 531), (250, 529), (250, 528), (252, 526), (253, 526), (254, 527), (254, 528), (255, 529), (256, 529), (257, 530), (257, 533), (258, 534), (262, 534), (263, 535), (263, 537), (264, 536), (264, 532), (263, 533), (260, 533), (259, 532), (259, 531), (258, 530), (258, 528), (259, 527), (260, 528), (261, 527), (262, 527), (262, 526), (260, 526), (259, 525), (258, 525), (257, 524), (257, 523), (258, 522), (258, 520), (257, 520), (256, 521), (252, 521), (251, 520), (251, 519), (250, 518), (250, 517), (251, 516), (251, 515), (250, 514), (250, 512), (249, 511), (249, 509), (248, 509), (247, 508), (247, 506), (244, 503), (244, 501), (243, 500), (242, 501), (241, 500), (241, 498), (240, 497), (240, 493), (239, 492), (239, 490), (238, 489), (238, 486), (237, 485), (237, 481), (238, 480), (238, 478)] , 
    # # # # [(595, 109), (594, 110), (590, 110), (589, 111), (588, 111), (587, 112), (585, 112), (583, 114), (582, 114), (581, 115), (580, 115), (580, 118), (581, 119), (581, 120), (582, 121), (582, 123), (583, 124), (583, 127), (584, 128), (584, 131), (585, 132), (585, 134), (586, 135), (586, 137), (588, 139), (590, 139), (591, 140), (591, 141), (592, 142), (592, 143), (593, 144), (593, 146), (594, 147), (594, 150), (595, 151), (595, 153), (596, 154), (598, 154), (599, 153), (600, 153), (602, 151), (603, 151), (604, 150), (605, 150), (606, 149), (607, 149), (609, 147), (611, 147), (612, 148), (613, 148), (614, 149), (616, 149), (617, 148), (618, 148), (620, 146), (623, 146), (624, 147), (625, 147), (626, 148), (627, 148), (628, 147), (630, 147), (631, 148), (636, 148), (637, 149), (638, 149), (641, 152), (644, 152), (645, 151), (646, 152), (647, 152), (648, 153), (649, 153), (650, 154), (652, 154), (655, 157), (657, 157), (661, 153), (664, 153), (665, 152), (670, 152), (671, 153), (672, 153), (673, 154), (674, 154), (675, 155), (676, 155), (677, 154), (678, 154), (679, 155), (682, 155), (683, 156), (683, 158), (684, 158), (685, 159), (686, 159), (689, 162), (691, 162), (698, 169), (702, 169), (703, 168), (704, 168), (705, 167), (706, 167), (707, 166), (708, 166), (709, 165), (709, 161), (708, 160), (708, 159), (707, 159), (706, 158), (705, 158), (704, 157), (702, 157), (701, 156), (700, 156), (695, 151), (692, 151), (691, 150), (688, 150), (686, 148), (685, 148), (683, 146), (683, 145), (682, 145), (681, 144), (678, 144), (677, 143), (678, 142), (682, 142), (683, 143), (684, 143), (685, 144), (686, 144), (684, 142), (685, 141), (686, 141), (686, 134), (687, 133), (688, 133), (689, 132), (689, 131), (690, 130), (690, 129), (691, 128), (692, 128), (694, 126), (697, 126), (696, 126), (694, 124), (694, 123), (696, 121), (695, 121), (694, 120), (693, 121), (692, 121), (690, 123), (688, 123), (687, 122), (685, 122), (683, 120), (680, 120), (679, 119), (677, 119), (676, 118), (676, 116), (668, 116), (667, 115), (664, 115), (664, 116), (663, 117), (663, 122), (662, 123), (658, 123), (657, 124), (655, 124), (654, 125), (652, 125), (651, 126), (647, 126), (646, 127), (640, 127), (639, 128), (637, 128), (636, 129), (635, 129), (634, 130), (631, 130), (629, 132), (628, 132), (627, 133), (626, 133), (625, 134), (625, 135), (623, 137), (622, 137), (621, 138), (619, 138), (618, 139), (616, 139), (615, 138), (618, 135), (618, 134), (619, 133), (619, 131), (620, 130), (620, 128), (619, 127), (619, 126), (618, 125), (618, 122), (617, 122), (616, 121), (616, 120), (615, 119), (615, 116), (614, 116), (613, 115), (610, 115), (609, 114), (605, 114), (604, 115), (603, 115), (601, 113), (601, 110), (600, 109), (599, 109), (598, 110), (597, 110), (596, 109)] , 
    # # # # [(1751, 401), (1749, 403), (1748, 402), (1747, 402), (1747, 403), (1745, 405), (1744, 404), (1742, 404), (1741, 405), (1740, 405), (1738, 407), (1734, 407), (1732, 409), (1731, 408), (1730, 408), (1729, 409), (1725, 409), (1724, 408), (1723, 409), (1722, 409), (1722, 411), (1724, 413), (1723, 414), (1723, 415), (1722, 416), (1724, 416), (1725, 417), (1724, 418), (1724, 420), (1725, 421), (1725, 423), (1726, 423), (1727, 422), (1728, 423), (1729, 422), (1730, 423), (1732, 423), (1732, 422), (1733, 421), (1734, 422), (1734, 423), (1735, 424), (1737, 424), (1738, 425), (1739, 425), (1740, 426), (1741, 425), (1742, 426), (1743, 426), (1744, 427), (1745, 427), (1745, 426), (1744, 425), (1744, 423), (1745, 422), (1746, 423), (1748, 421), (1749, 421), (1750, 422), (1754, 422), (1755, 423), (1757, 423), (1758, 422), (1759, 423), (1760, 422), (1760, 421), (1761, 420), (1762, 420), (1763, 421), (1764, 420), (1764, 417), (1765, 416), (1765, 415), (1768, 412), (1769, 412), (1769, 410), (1768, 409), (1768, 407), (1767, 407), (1766, 406), (1764, 406), (1763, 407), (1762, 406), (1762, 404), (1761, 403), (1761, 402), (1760, 401), (1755, 401), (1754, 402), (1753, 402), (1752, 401)] , 
    # # # # # [(644, 210), (643, 211), (644, 212), (643, 213), (643, 214), (644, 215), (644, 218), (645, 219), (645, 221), (646, 222), (646, 223), (647, 224), (648, 224), (652, 228), (653, 228), (654, 229), (656, 229), (657, 228), (658, 229), (658, 230), (659, 230), (662, 233), (662, 234), (664, 234), (665, 233), (667, 233), (668, 232), (669, 232), (671, 230), (672, 230), (673, 229), (674, 229), (675, 228), (676, 228), (676, 227), (677, 226), (679, 226), (681, 224), (681, 223), (682, 222), (682, 220), (683, 219), (682, 219), (681, 218), (672, 218), (672, 220), (671, 221), (668, 221), (667, 222), (666, 221), (662, 221), (661, 220), (661, 219), (660, 219), (658, 217), (656, 217), (655, 216), (654, 216), (653, 217), (652, 216), (652, 214), (653, 213), (653, 212), (652, 213), (651, 212), (647, 212), (645, 210)] , 
    # # # # [(565, 163), (564, 164), (562, 164), (561, 165), (560, 165), (559, 164), (558, 165), (559, 166), (559, 167), (560, 168), (560, 171), (561, 172), (561, 173), (564, 176), (564, 181), (567, 181), (569, 183), (570, 183), (571, 184), (571, 185), (573, 187), (573, 188), (574, 189), (576, 189), (577, 188), (585, 188), (585, 184), (586, 183), (587, 183), (587, 182), (586, 181), (585, 182), (584, 182), (583, 181), (583, 179), (582, 180), (579, 177), (579, 175), (580, 174), (580, 172), (579, 171), (579, 170), (578, 170), (573, 165), (566, 165), (565, 164)] , 
    # # # # [(516, 195), (516, 197), (515, 198), (514, 198), (514, 199), (513, 200), (512, 200), (511, 199), (509, 199), (509, 200), (511, 202), (511, 203), (514, 203), (515, 202), (517, 202), (518, 203), (518, 205), (520, 205), (521, 206), (521, 207), (523, 209), (524, 209), (525, 210), (526, 209), (527, 210), (527, 211), (532, 211), (533, 212), (535, 212), (536, 213), (536, 214), (538, 214), (539, 215), (539, 216), (540, 217), (540, 216), (541, 215), (542, 215), (543, 216), (544, 216), (545, 217), (548, 217), (549, 218), (549, 219), (552, 219), (553, 220), (553, 221), (557, 217), (558, 217), (559, 216), (560, 217), (562, 217), (563, 216), (564, 216), (565, 215), (567, 215), (568, 214), (569, 215), (570, 214), (571, 214), (572, 213), (573, 213), (574, 212), (575, 213), (578, 213), (581, 216), (582, 215), (586, 215), (586, 214), (587, 213), (588, 214), (589, 214), (589, 213), (590, 212), (591, 212), (593, 210), (593, 209), (594, 208), (594, 207), (588, 207), (588, 208), (587, 209), (586, 208), (583, 208), (582, 207), (581, 207), (580, 206), (579, 206), (578, 205), (577, 206), (575, 206), (574, 205), (572, 205), (571, 206), (569, 204), (568, 204), (567, 205), (565, 205), (564, 204), (562, 204), (562, 205), (561, 206), (560, 205), (559, 205), (559, 206), (557, 208), (555, 206), (555, 207), (554, 208), (553, 208), (552, 207), (549, 207), (547, 205), (547, 203), (546, 203), (545, 202), (539, 202), (538, 201), (537, 202), (536, 201), (533, 201), (532, 200), (531, 200), (530, 199), (524, 199), (522, 197), (519, 197), (518, 196), (518, 195)] , 
    # # # # [(706, 288), (709, 291), (710, 291), (713, 294), (713, 296), (714, 296), (715, 297), (715, 300), (714, 301), (713, 301), (712, 302), (712, 304), (711, 305), (711, 311), (710, 312), (710, 314), (709, 315), (709, 318), (711, 316), (712, 316), (713, 317), (712, 318), (712, 319), (713, 318), (713, 317), (715, 315), (716, 315), (717, 314), (717, 313), (719, 311), (720, 312), (721, 312), (722, 311), (727, 311), (728, 312), (728, 313), (729, 314), (729, 316), (731, 318), (731, 321), (738, 321), (739, 320), (741, 320), (742, 321), (744, 321), (746, 323), (747, 323), (750, 326), (751, 326), (752, 327), (752, 329), (756, 333), (756, 332), (757, 331), (759, 331), (759, 330), (760, 329), (761, 330), (762, 330), (761, 329), (762, 328), (763, 328), (764, 327), (765, 328), (765, 323), (766, 322), (767, 323), (767, 328), (768, 327), (768, 325), (769, 324), (771, 324), (774, 321), (775, 321), (777, 319), (779, 319), (779, 318), (778, 317), (778, 315), (776, 315), (775, 316), (774, 316), (774, 318), (773, 319), (772, 319), (771, 318), (765, 318), (763, 316), (762, 316), (761, 315), (759, 315), (758, 314), (758, 313), (757, 312), (755, 312), (753, 314), (751, 312), (751, 311), (750, 310), (750, 309), (749, 308), (749, 304), (750, 303), (751, 304), (751, 302), (750, 302), (748, 300), (748, 299), (747, 300), (745, 300), (744, 301), (743, 301), (742, 302), (741, 302), (740, 303), (739, 303), (738, 304), (737, 303), (737, 301), (736, 300), (736, 299), (735, 298), (736, 297), (736, 294), (737, 293), (739, 293), (738, 293), (737, 292), (737, 291), (733, 291), (732, 292), (730, 290), (728, 290), (727, 289), (726, 289), (725, 288), (724, 289), (720, 289), (719, 288), (717, 288), (717, 292), (716, 293), (715, 292), (714, 292), (713, 291), (712, 291), (711, 290), (710, 290), (708, 288)] , 
    # # [(1037, 445 ), (1037, 446), (1036, 447), (1036, 448), (1034, 450), (1034, 452), (1033, 453), (1033, 454), (1032, 455), (1032, 457), (1030, 459), (1030, 460), (1029, 461), (1029, 462), (1028, 463), (1028, 464), (1027, 465), (1027, 466), (1026, 467), (1026, 468), (1025, 469), (1025, 471), (1024, 472), (1024, 473), (1023, 474), (1023, 476), (1021, 478), (1021, 479), (1020, 480), (1020, 481), (1019, 482), (1019, 483), (1018, 484), (1018, 486), (1016, 488), (1016, 490), (1014, 492), (1014, 494), (1013, 495), (1013, 496), (1012, 497), (1012, 498), (1011, 499), (1012, 500), (1014, 500), (1015, 501), (1017, 501), (1018, 502), (1020, 502), (1020, 500), (1023, 497), (1022, 496), (1022, 495), (1023, 494), (1024, 495), (1024, 493), (1025, 492), (1025, 485), (1026, 484), (1026, 483), (1028, 481), (1029, 481), (1030, 482), (1030, 481), (1029, 480), (1030, 479), (1030, 478), (1033, 475), (1033, 474), (1034, 473), (1034, 470), (1035, 469), (1035, 468), (1036, 467), (1036, 466), (1038, 464), (1038, 463), (1039, 462), (1039, 461), (1040, 460), (1040, 459), (1041, 458), (1041, 454), (1042, 453), (1041, 452), (1042, 451), (1042, 450), (1043, 449), (1042, 449), (1038, 445)] , 
    # # # [(1261, 368), (1260, 369), (1256, 369), (1255, 370), (1254, 370), (1253, 371), (1252, 371), (1251, 372), (1247, 372), (1246, 373), (1245, 373), (1244, 374), (1239, 374), (1238, 373), (1237, 373), (1236, 374), (1233, 374), (1231, 376), (1228, 376), (1227, 375), (1227, 376), (1226, 377), (1225, 376), (1224, 376), (1223, 377), (1222, 377), (1221, 378), (1220, 378), (1218, 380), (1217, 380), (1216, 381), (1215, 381), (1214, 382), (1213, 382), (1213, 383), (1211, 385), (1210, 385), (1210, 386), (1212, 386), (1213, 385), (1214, 386), (1214, 387), (1215, 386), (1216, 387), (1218, 387), (1220, 385), (1223, 388), (1222, 389), (1223, 390), (1223, 391), (1226, 391), (1227, 390), (1228, 391), (1230, 391), (1232, 393), (1233, 392), (1234, 392), (1235, 391), (1235, 390), (1236, 389), (1237, 389), (1239, 387), (1242, 387), (1242, 386), (1243, 385), (1245, 385), (1247, 383), (1248, 383), (1249, 382), (1250, 382), (1250, 381), (1254, 377), (1255, 378), (1261, 378), (1263, 376), (1264, 376), (1264, 370), (1263, 369), (1263, 368)] , 
    # # # [(1217, 464), (1216, 465), (1206, 465), (1205, 466), (1204, 465), (1203, 466), (1201, 466), (1197, 470), (1196, 470), (1195, 471), (1194, 471), (1193, 470), (1188, 470), (1187, 469), (1185, 469), (1184, 468), (1177, 468), (1176, 467), (1174, 467), (1175, 467), (1178, 470), (1179, 470), (1181, 472), (1180, 473), (1182, 475), (1180, 477), (1182, 477), (1183, 478), (1184, 477), (1186, 477), (1187, 478), (1188, 477), (1190, 477), (1191, 476), (1195, 476), (1196, 477), (1196, 478), (1197, 477), (1198, 477), (1199, 478), (1200, 477), (1201, 477), (1202, 476), (1207, 476), (1208, 475), (1214, 475), (1215, 474), (1222, 474), (1223, 473), (1224, 473), (1225, 474), (1225, 475), (1226, 475), (1226, 474), (1225, 473), (1225, 468), (1226, 467), (1224, 467), (1223, 466), (1224, 465), (1226, 465), (1227, 464), (1221, 464), (1220, 465), (1218, 465)] , 
    # # # [(1182, 318), (1183, 318), (1184, 319), (1184, 320), (1183, 321), (1178, 321), (1177, 322), (1170, 322), (1169, 321), (1167, 321), (1166, 320), (1163, 320), (1162, 321), (1161, 321), (1160, 320), (1146, 320), (1145, 319), (1144, 319), (1144, 320), (1143, 321), (1143, 322), (1142, 323), (1140, 323), (1142, 323), (1143, 324), (1143, 325), (1142, 326), (1137, 326), (1136, 327), (1135, 327), (1135, 328), (1136, 329), (1136, 330), (1137, 331), (1137, 333), (1138, 334), (1138, 335), (1139, 336), (1139, 339), (1141, 341), (1141, 342), (1141, 340), (1139, 338), (1140, 337), (1141, 337), (1142, 338), (1143, 337), (1143, 335), (1142, 334), (1142, 332), (1143, 331), (1144, 331), (1144, 330), (1147, 327), (1152, 327), (1153, 326), (1158, 326), (1159, 327), (1160, 327), (1161, 328), (1161, 329), (1162, 328), (1163, 328), (1164, 327), (1165, 328), (1166, 327), (1169, 327), (1170, 328), (1171, 328), (1172, 329), (1176, 329), (1177, 330), (1179, 330), (1180, 331), (1183, 331), (1184, 332), (1184, 335), (1181, 338), (1180, 338), (1180, 341), (1176, 345), (1176, 349), (1175, 350), (1175, 351), (1174, 352), (1174, 353), (1176, 355), (1176, 356), (1176, 355), (1177, 354), (1178, 354), (1179, 353), (1179, 350), (1180, 349), (1182, 349), (1182, 348), (1183, 347), (1184, 347), (1185, 348), (1186, 348), (1187, 347), (1188, 347), (1188, 345), (1189, 344), (1189, 342), (1190, 341), (1189, 340), (1189, 339), (1190, 338), (1191, 338), (1193, 340), (1196, 337), (1197, 338), (1198, 337), (1199, 337), (1200, 336), (1201, 337), (1202, 336), (1202, 335), (1201, 334), (1201, 329), (1203, 327), (1204, 327), (1204, 325), (1205, 324), (1209, 324), (1209, 323), (1210, 322), (1209, 322), (1207, 320), (1208, 319), (1208, 318), (1205, 318), (1204, 319), (1202, 319), (1201, 320), (1193, 320), (1192, 319), (1191, 320), (1190, 320), (1189, 319), (1187, 321), (1184, 318)] , 
    # # # # # [(971, 171), (971, 172), (970, 173), (970, 175), (971, 176), (969, 178), (970, 178), (971, 179), (971, 180), (972, 179), (973, 179), (974, 180), (975, 180), (977, 182), (978, 182), (979, 183), (980, 183), (981, 184), (981, 185), (984, 185), (985, 186), (986, 186), (987, 187), (988, 187), (989, 188), (990, 188), (993, 191), (994, 191), (995, 192), (995, 193), (996, 194), (996, 195), (998, 195), (1000, 193), (1001, 193), (1003, 191), (1004, 192), (1004, 191), (1005, 190), (1006, 190), (1008, 192), (1009, 191), (1010, 192), (1011, 191), (1012, 191), (1013, 192), (1015, 192), (1016, 191), (1017, 191), (1013, 191), (1011, 189), (1012, 188), (1011, 187), (1012, 186), (1012, 184), (1011, 183), (1011, 182), (1009, 184), (1008, 184), (1007, 183), (1003, 183), (1002, 182), (1001, 182), (1000, 181), (1001, 180), (1000, 180), (999, 179), (999, 178), (998, 177), (997, 177), (995, 175), (992, 175), (991, 174), (989, 174), (988, 173), (986, 173), (985, 174), (984, 174), (983, 173), (978, 173), (977, 172), (975, 172), (974, 173), (973, 172), (972, 172)] , 
    # # # # # [(654, 82), (653, 83), (652, 83), (652, 87), (651, 88), (648, 88), (648, 89), (647, 90), (645, 88), (642, 88), (640, 90), (640, 92), (639, 93), (637, 91), (631, 91), (630, 92), (626, 92), (625, 93), (624, 93), (622, 95), (621, 95), (620, 96), (620, 99), (621, 99), (622, 100), (622, 101), (623, 102), (623, 103), (625, 105), (625, 106), (627, 108), (630, 108), (631, 109), (632, 109), (634, 111), (634, 113), (635, 113), (636, 112), (637, 112), (638, 111), (639, 111), (639, 110), (641, 108), (642, 108), (643, 107), (644, 107), (645, 106), (649, 106), (650, 105), (650, 104), (652, 102), (654, 102), (654, 100), (661, 93), (661, 92), (662, 91), (661, 90), (661, 89), (660, 88), (661, 87), (660, 87), (659, 86), (659, 85), (658, 84), (658, 83), (657, 82)] , 
    # # # # [(1669, 555), (1668, 556), (1664, 556), (1663, 557), (1659, 557), (1660, 558), (1659, 559), (1659, 561), (1663, 565), (1663, 566), (1664, 567), (1664, 568), (1666, 570), (1668, 570), (1669, 571), (1670, 571), (1671, 572), (1672, 572), (1673, 573), (1675, 573), (1676, 574), (1678, 574), (1679, 575), (1681, 575), (1682, 576), (1687, 576), (1688, 577), (1689, 577), (1690, 578), (1692, 578), (1693, 579), (1693, 580), (1696, 580), (1697, 579), (1698, 580), (1698, 581), (1699, 581), (1700, 580), (1701, 581), (1703, 581), (1704, 582), (1705, 582), (1706, 583), (1706, 584), (1707, 584), (1708, 585), (1713, 585), (1714, 586), (1716, 586), (1717, 587), (1718, 587), (1719, 586), (1720, 587), (1721, 586), (1723, 586), (1724, 585), (1728, 585), (1729, 584), (1726, 581), (1726, 580), (1728, 578), (1729, 579), (1729, 578), (1730, 577), (1734, 577), (1733, 576), (1733, 575), (1732, 575), (1731, 574), (1732, 573), (1731, 573), (1730, 574), (1729, 573), (1729, 571), (1728, 571), (1726, 569), (1725, 569), (1724, 568), (1720, 568), (1719, 567), (1718, 567), (1717, 568), (1716, 567), (1715, 567), (1714, 566), (1710, 566), (1709, 565), (1708, 565), (1707, 566), (1706, 566), (1704, 564), (1702, 564), (1700, 562), (1698, 562), (1697, 561), (1693, 561), (1692, 560), (1690, 560), (1689, 559), (1686, 559), (1685, 558), (1683, 558), (1682, 557), (1677, 557), (1676, 556), (1673, 556), (1672, 555), (1671, 556), (1670, 555)] , 
    # # # # # [(595, 108), (595, 109), (594, 110), (593, 110), (592, 109), (590, 109), (590, 110), (589, 111), (588, 111), (587, 112), (586, 112), (585, 111), (585, 112), (584, 113), (583, 113), (584, 113), (585, 114), (584, 115), (581, 115), (580, 114), (579, 115), (579, 117), (580, 118), (580, 119), (581, 120), (581, 121), (582, 122), (582, 125), (583, 126), (583, 129), (584, 130), (584, 132), (585, 133), (585, 135), (586, 136), (586, 137), (587, 138), (587, 139), (589, 139), (592, 142), (592, 143), (593, 144), (593, 147), (594, 148), (594, 155), (595, 156), (595, 158), (596, 158), (597, 159), (599, 157), (600, 157), (600, 156), (603, 153), (604, 153), (606, 151), (607, 151), (608, 150), (609, 151), (609, 150), (611, 148), (612, 149), (612, 150), (613, 149), (614, 150), (614, 151), (613, 152), (612, 152), (614, 152), (617, 149), (618, 149), (618, 148), (620, 146), (621, 146), (622, 147), (623, 146), (625, 148), (627, 148), (628, 147), (630, 147), (631, 148), (633, 148), (634, 149), (635, 148), (636, 148), (637, 149), (638, 149), (640, 151), (640, 152), (643, 152), (644, 153), (645, 153), (647, 155), (648, 155), (649, 156), (649, 155), (650, 154), (653, 154), (654, 155), (654, 157), (658, 157), (659, 158), (659, 155), (660, 154), (661, 154), (662, 153), (665, 153), (666, 152), (670, 152), (671, 153), (671, 154), (672, 155), (673, 155), (674, 156), (676, 156), (677, 155), (681, 155), (683, 157), (683, 158), (684, 158), (685, 159), (686, 159), (689, 162), (691, 162), (693, 164), (693, 165), (694, 165), (698, 169), (699, 169), (700, 170), (701, 170), (703, 168), (704, 168), (706, 166), (708, 166), (709, 165), (710, 165), (711, 164), (712, 164), (712, 163), (711, 162), (711, 158), (712, 157), (711, 156), (710, 157), (708, 157), (707, 158), (706, 157), (706, 155), (707, 154), (706, 154), (705, 155), (704, 155), (703, 154), (702, 154), (701, 153), (700, 153), (699, 152), (698, 152), (697, 153), (696, 152), (696, 151), (694, 151), (692, 149), (692, 148), (691, 147), (691, 146), (690, 145), (691, 144), (690, 143), (690, 141), (689, 140), (688, 140), (686, 138), (686, 136), (681, 136), (680, 135), (680, 134), (681, 133), (682, 133), (682, 132), (681, 131), (680, 131), (679, 130), (679, 127), (678, 127), (677, 126), (677, 124), (676, 123), (677, 122), (678, 122), (679, 123), (679, 122), (678, 121), (678, 119), (677, 119), (676, 118), (676, 117), (675, 116), (674, 117), (671, 117), (669, 115), (668, 116), (666, 114), (666, 113), (666, 114), (665, 115), (664, 114), (663, 115), (664, 116), (664, 118), (665, 119), (665, 120), (664, 121), (664, 123), (663, 124), (661, 124), (660, 123), (657, 123), (656, 124), (654, 124), (653, 125), (650, 125), (649, 126), (643, 126), (642, 127), (638, 127), (637, 128), (636, 128), (635, 129), (634, 129), (633, 130), (632, 129), (631, 130), (630, 130), (629, 131), (628, 130), (628, 123), (627, 123), (626, 122), (625, 122), (624, 121), (624, 119), (623, 118), (623, 116), (622, 117), (621, 117), (620, 116), (620, 115), (614, 115), (613, 114), (612, 115), (611, 115), (610, 114), (609, 114), (608, 113), (607, 113), (606, 112), (606, 111), (603, 111), (602, 110), (602, 109), (601, 109), (600, 108)] , 
    # # [(1103, 540), (1103, 541), (1101, 543), (1101, 544), (1100, 545), (1100, 546), (1098, 548), (1098, 549), (1097, 550), (1097, 551), (1095, 553), (1095, 554), (1094, 555), (1094, 558), (1095, 558), (1097, 560), (1098, 560), (1099, 559), (1100, 560), (1101, 560), (1101, 559), (1102, 558), (1103, 558), (1103, 553), (1104, 552), (1104, 549), (1106, 547), (1106, 546), (1107, 545), (1107, 544), (1108, 543), (1107, 542), (1106, 542), (1104, 540)] , 
    # # # [(625, 225), (624, 226), (623, 226), (623, 227), (621, 229), (620, 228), (620, 227), (619, 226), (618, 227), (616, 227), (615, 228), (610, 228), (609, 227), (608, 227), (606, 229), (604, 229), (603, 230), (599, 230), (598, 229), (597, 229), (594, 232), (593, 232), (594, 233), (593, 234), (592, 234), (593, 235), (592, 236), (593, 237), (592, 238), (591, 238), (592, 238), (593, 239), (593, 240), (594, 240), (595, 241), (593, 243), (592, 243), (591, 244), (590, 244), (588, 242), (588, 241), (586, 241), (585, 240), (577, 240), (575, 238), (574, 238), (572, 240), (570, 240), (569, 241), (569, 242), (568, 243), (560, 243), (560, 245), (559, 246), (558, 246), (557, 247), (556, 247), (555, 248), (555, 249), (557, 251), (558, 251), (559, 252), (561, 252), (562, 253), (563, 253), (564, 254), (567, 254), (568, 253), (569, 253), (570, 254), (575, 254), (576, 255), (578, 255), (579, 256), (579, 257), (580, 257), (580, 256), (579, 255), (580, 254), (589, 254), (588, 254), (587, 253), (588, 252), (590, 252), (591, 253), (592, 252), (594, 252), (595, 253), (597, 253), (598, 254), (603, 254), (604, 253), (603, 252), (604, 251), (605, 251), (606, 250), (609, 250), (610, 251), (617, 251), (618, 252), (620, 252), (621, 253), (623, 251), (624, 251), (625, 252), (630, 252), (629, 251), (628, 251), (627, 250), (627, 247), (628, 246), (629, 247), (631, 247), (631, 246), (630, 245), (629, 245), (628, 244), (629, 243), (630, 243), (629, 242), (630, 241), (632, 241), (632, 239), (634, 237), (636, 237), (635, 236), (635, 235), (632, 235), (631, 234), (625, 234), (624, 233), (621, 233), (620, 232), (622, 230), (623, 230), (624, 231), (624, 228), (625, 227), (625, 226), (626, 225)],
    # # # # # [(1058, 192), (1057, 193), (1055, 193), (1055, 196), (1056, 196), (1058, 198), (1057, 199), (1056, 199), (1055, 198), (1050, 198), (1050, 199), (1049, 200), (1048, 200), (1048, 202), (1047, 203), (1048, 203), (1049, 204), (1048, 205), (1046, 205), (1048, 205), (1049, 206), (1049, 207), (1050, 206), (1051, 207), (1052, 207), (1053, 208), (1053, 209), (1054, 209), (1055, 210), (1054, 211), (1057, 214), (1058, 213), (1059, 214), (1061, 214), (1063, 216), (1063, 217), (1064, 217), (1065, 218), (1065, 220), (1066, 221), (1066, 219), (1067, 218), (1067, 217), (1069, 215), (1068, 214), (1068, 212), (1069, 211), (1069, 210), (1068, 209), (1068, 208), (1066, 208), (1064, 206), (1064, 205), (1065, 204), (1065, 201), (1062, 198), (1062, 197), (1061, 196), (1060, 197), (1059, 197), (1058, 196), (1059, 195), (1058, 195), (1057, 194), (1058, 193), (1059, 193)] , 
    # # # [(1059, 194), (1059, 195), (1057, 197), (1055, 197), (1054, 198), (1054, 200), (1053, 201), (1052, 200), (1052, 201), (1053, 202), (1053, 203), (1054, 204), (1054, 205), (1055, 206), (1055, 207), (1056, 207), (1058, 209), (1058, 210), (1059, 210), (1060, 211), (1060, 215), (1059, 216), (1061, 218), (1060, 219), (1060, 220), (1061, 220), (1063, 222), (1063, 225), (1064, 226), (1064, 227), (1063, 228), (1064, 228), (1065, 229), (1066, 229), (1067, 228), (1068, 229), (1069, 229), (1070, 228), (1071, 228), (1073, 230), (1073, 231), (1074, 231), (1075, 232), (1074, 233), (1072, 233), (1071, 232), (1070, 232), (1071, 233), (1071, 235), (1071, 234), (1072, 233), (1074, 235), (1074, 236), (1073, 237), (1073, 241), (1072, 242), (1073, 243), (1073, 244), (1072, 245), (1072, 247), (1073, 246), (1073, 245), (1074, 244), (1074, 241), (1073, 240), (1074, 239), (1075, 239), (1075, 238), (1076, 237), (1077, 237), (1078, 236), (1079, 236), (1080, 235), (1081, 236), (1082, 235), (1084, 235), (1086, 237), (1085, 238), (1087, 238), (1088, 237), (1089, 238), (1090, 238), (1091, 239), (1091, 243), (1092, 242), (1093, 243), (1095, 241), (1095, 240), (1094, 239), (1094, 237), (1091, 237), (1090, 236), (1089, 236), (1087, 234), (1087, 230), (1085, 230), (1084, 229), (1083, 229), (1081, 227), (1081, 226), (1081, 228), (1080, 229), (1079, 229), (1078, 228), (1077, 228), (1076, 227), (1076, 218), (1075, 217), (1075, 214), (1073, 214), (1072, 213), (1072, 212), (1071, 211), (1071, 209), (1068, 206), (1068, 205), (1067, 205), (1065, 203), (1065, 200), (1064, 200), (1062, 198), (1062, 197), (1061, 196), (1061, 195), (1060, 196), (1059, 195)] , 
    # [(350, 323), (349, 324), (344, 324), (343, 325), (342, 325), (340, 327), (339, 327), (338, 328), (336, 328), (336, 329), (335, 330), (334, 330), (334, 331), (333, 332), (329, 332), (327, 334), (326, 334), (325, 335), (324, 335), (324, 336), (323, 337), (322, 336), (320, 336), (319, 335), (319, 333), (317, 333), (317, 334), (316, 335), (315, 335), (314, 334), (314, 333), (313, 334), (312, 334), (312, 335), (313, 336), (315, 336), (316, 337), (316, 339), (315, 340), (313, 340), (312, 341), (311, 341), (310, 340), (310, 341), (307, 344), (303, 344), (303, 345), (302, 346), (301, 346), (299, 348), (298, 348), (297, 349), (296, 349), (296, 351), (295, 352), (294, 352), (294, 353), (293, 354), (292, 354), (289, 357), (288, 356), (287, 356), (286, 355), (286, 354), (286, 355), (285, 356), (282, 356), (282, 358), (281, 359), (281, 360), (280, 361), (279, 361), (280, 362), (281, 362), (282, 363), (283, 363), (284, 364), (285, 363), (284, 362), (285, 361), (286, 361), (289, 358), (290, 359), (290, 362), (289, 363), (289, 365), (288, 366), (286, 366), (286, 368), (287, 368), (288, 369), (286, 371), (286, 373), (288, 371), (288, 370), (289, 369), (288, 368), (290, 366), (291, 367), (291, 371), (291, 370), (292, 369), (292, 365), (293, 364), (293, 363), (294, 362), (296, 362), (297, 361), (297, 360), (298, 359), (299, 360), (304, 360), (305, 359), (307, 359), (308, 360), (311, 357), (312, 358), (312, 357), (315, 354), (316, 354), (318, 352), (319, 352), (321, 350), (323, 350), (324, 349), (325, 349), (325, 346), (326, 345), (328, 345), (329, 346), (328, 347), (330, 347), (332, 345), (335, 345), (337, 343), (340, 343), (342, 341), (344, 341), (345, 340), (346, 340), (347, 339), (349, 339), (348, 339), (347, 338), (348, 337), (348, 335), (349, 334), (350, 334), (350, 332), (349, 332), (348, 331), (350, 329), (350, 327), (351, 326), (351, 324)]]
    
    coordinates = [
    [(1217, 464), (1216, 465), (1206, 465), (1205, 466), (1204, 465), (1203, 466), (1201, 466), (1197, 470), (1196, 470), (1195, 471), (1194, 471), (1193, 470), (1188, 470), (1187, 469), (1185, 469), (1184, 468), (1177, 468), (1176, 467), (1174, 467), (1175, 467), (1178, 470), (1179, 470), (1181, 472), (1180, 473), (1182, 475), (1180, 477), (1182, 477), (1183, 478), (1184, 477), (1186, 477), (1187, 478), (1188, 477), (1190, 477), (1191, 476), (1195, 476), (1196, 477), (1196, 478), (1197, 477), (1198, 477), (1199, 478), (1200, 477), (1201, 477), (1202, 476), (1207, 476), (1208, 475), (1214, 475), (1215, 474), (1222, 474), (1223, 473), (1224, 473), (1225, 474), (1225, 475), (1226, 475), (1226, 474), (1225, 473), (1225, 468), (1226, 467), (1224, 467), (1223, 466), (1224, 465), (1226, 465), (1227, 464), (1221, 464), (1220, 465), (1218, 465)] , 
    [(625, 225), (624, 226), (623, 226), (623, 227), (621, 229), (620, 228), (620, 227), (619, 226), (618, 227), (616, 227), (615, 228), (610, 228), (609, 227), (608, 227), (606, 229), (604, 229), (603, 230), (599, 230), (598, 229), (597, 229), (594, 232), (593, 232), (594, 233), (593, 234), (592, 234), (593, 235), (592, 236), (593, 237), (592, 238), (591, 238), (592, 238), (593, 239), (593, 240), (594, 240), (595, 241), (593, 243), (592, 243), (591, 244), (590, 244), (588, 242), (588, 241), (586, 241), (585, 240), (577, 240), (575, 238), (574, 238), (572, 240), (570, 240), (569, 241), (569, 242), (568, 243), (560, 243), (560, 245), (559, 246), (558, 246), (557, 247), (556, 247), (555, 248), (555, 249), (557, 251), (558, 251), (559, 252), (561, 252), (562, 253), (563, 253), (564, 254), (567, 254), (568, 253), (569, 253), (570, 254), (575, 254), (576, 255), (578, 255), (579, 256), (579, 257), (580, 257), (580, 256), (579, 255), (580, 254), (589, 254), (588, 254), (587, 253), (588, 252), (590, 252), (591, 253), (592, 252), (594, 252), (595, 253), (597, 253), (598, 254), (603, 254), (604, 253), (603, 252), (604, 251), (605, 251), (606, 250), (609, 250), (610, 251), (617, 251), (618, 252), (620, 252), (621, 253), (623, 251), (624, 251), (625, 252), (630, 252), (629, 251), (628, 251), (627, 250), (627, 247), (628, 246), (629, 247), (631, 247), (631, 246), (630, 245), (629, 245), (628, 244), (629, 243), (630, 243), (629, 242), (630, 241), (632, 241), (632, 239), (634, 237), (636, 237), (635, 236), (635, 235), (632, 235), (631, 234), (625, 234), (624, 233), (621, 233), (620, 232), (622, 230), (623, 230), (624, 231), (624, 228), (625, 227), (625, 226), (626, 225)], 
    [(237, 477), (234, 480), (233, 480), (233, 484), (230, 487), (230, 490), (231, 491), (231, 492), (232, 492), (233, 493), (233, 499), (231, 501), (230, 501), (229, 500), (229, 501), (227, 503), (228, 504), (228, 506), (229, 505), (230, 505), (231, 506), (230, 507), (230, 508), (229, 509), (229, 510), (228, 511), (227, 510), (226, 511), (227, 511), (228, 512), (227, 513), (224, 513), (224, 514), (223, 515), (223, 517), (224, 518), (223, 519), (223, 521), (222, 522), (221, 521), (221, 520), (220, 521), (220, 523), (219, 524), (219, 526), (220, 527), (220, 528), (221, 529), (221, 531), (222, 532), (222, 534), (223, 535), (224, 534), (225, 534), (226, 535), (227, 535), (227, 534), (228, 533), (229, 534), (229, 535), (230, 536), (230, 534), (232, 532), (233, 533), (233, 536), (232, 537), (233, 537), (234, 538), (237, 535), (238, 536), (239, 536), (240, 537), (241, 537), (242, 536), (244, 536), (244, 535), (246, 533), (247, 533), (248, 532), (248, 531), (250, 529), (250, 528), (252, 526), (253, 526), (254, 527), (254, 528), (255, 529), (256, 529), (257, 530), (257, 533), (258, 534), (262, 534), (263, 535), (263, 537), (264, 536), (264, 532), (263, 533), (260, 533), (259, 532), (259, 531), (258, 530), (258, 528), (259, 527), (260, 528), (261, 527), (262, 527), (262, 526), (260, 526), (259, 525), (258, 525), (257, 524), (257, 523), (258, 522), (258, 520), (257, 520), (256, 521), (252, 521), (251, 520), (251, 519), (250, 518), (250, 517), (251, 516), (251, 515), (250, 514), (250, 512), (249, 511), (249, 509), (248, 509), (247, 508), (247, 506), (244, 503), (244, 501), (243, 500), (242, 501), (241, 500), (241, 498), (240, 497), (240, 493), (239, 492), (239, 490), (238, 489), (238, 486), (237, 485), (237, 481), (238, 480), (238, 478)] , 
    [(350, 323), (349, 324), (344, 324), (343, 325), (342, 325), (340, 327), (339, 327), (338, 328), (336, 328), (336, 329), (335, 330), (334, 330), (334, 331), (333, 332), (329, 332), (327, 334), (326, 334), (325, 335), (324, 335), (324, 336), (323, 337), (322, 336), (320, 336), (319, 335), (319, 333), (317, 333), (317, 334), (316, 335), (315, 335), (314, 334), (314, 333), (313, 334), (312, 334), (312, 335), (313, 336), (315, 336), (316, 337), (316, 339), (315, 340), (313, 340), (312, 341), (311, 341), (310, 340), (310, 341), (307, 344), (303, 344), (303, 345), (302, 346), (301, 346), (299, 348), (298, 348), (297, 349), (296, 349), (296, 351), (295, 352), (294, 352), (294, 353), (293, 354), (292, 354), (289, 357), (288, 356), (287, 356), (286, 355), (286, 354), (286, 355), (285, 356), (282, 356), (282, 358), (281, 359), (281, 360), (280, 361), (279, 361), (280, 362), (281, 362), (282, 363), (283, 363), (284, 364), (285, 363), (284, 362), (285, 361), (286, 361), (289, 358), (290, 359), (290, 362), (289, 363), (289, 365), (288, 366), (286, 366), (286, 368), (287, 368), (288, 369), (286, 371), (286, 373), (288, 371), (288, 370), (289, 369), (288, 368), (290, 366), (291, 367), (291, 371), (291, 370), (292, 369), (292, 365), (293, 364), (293, 363), (294, 362), (296, 362), (297, 361), (297, 360), (298, 359), (299, 360), (304, 360), (305, 359), (307, 359), (308, 360), (311, 357), (312, 358), (312, 357), (315, 354), (316, 354), (318, 352), (319, 352), (321, 350), (323, 350), (324, 349), (325, 349), (325, 346), (326, 345), (328, 345), (329, 346), (328, 347), (330, 347), (332, 345), (335, 345), (337, 343), (340, 343), (342, 341), (344, 341), (345, 340), (346, 340), (347, 339), (349, 339), (348, 339), (347, 338), (348, 337), (348, 335), (349, 334), (350, 334), (350, 332), (349, 332), (348, 331), (350, 329), (350, 327), (351, 326), (351, 324)],
    [(1059, 194), (1059, 195), (1057, 197), (1055, 197), (1054, 198), (1054, 200), (1053, 201), (1052, 200), (1052, 201), (1053, 202), (1053, 203), (1054, 204), (1054, 205), (1055, 206), (1055, 207), (1056, 207), (1058, 209), (1058, 210), (1059, 210), (1060, 211), (1060, 215), (1059, 216), (1061, 218), (1060, 219), (1060, 220), (1061, 220), (1063, 222), (1063, 225), (1064, 226), (1064, 227), (1063, 228), (1064, 228), (1065, 229), (1066, 229), (1067, 228), (1068, 229), (1069, 229), (1070, 228), (1071, 228), (1073, 230), (1073, 231), (1074, 231), (1075, 232), (1074, 233), (1072, 233), (1071, 232), (1070, 232), (1071, 233), (1071, 235), (1071, 234), (1072, 233), (1074, 235), (1074, 236), (1073, 237), (1073, 241), (1072, 242), (1073, 243), (1073, 244), (1072, 245), (1072, 247), (1073, 246), (1073, 245), (1074, 244), (1074, 241), (1073, 240), (1074, 239), (1075, 239), (1075, 238), (1076, 237), (1077, 237), (1078, 236), (1079, 236), (1080, 235), (1081, 236), (1082, 235), (1084, 235), (1086, 237), (1085, 238), (1087, 238), (1088, 237), (1089, 238), (1090, 238), (1091, 239), (1091, 243), (1092, 242), (1093, 243), (1095, 241), (1095, 240), (1094, 239), (1094, 237), (1091, 237), (1090, 236), (1089, 236), (1087, 234), (1087, 230), (1085, 230), (1084, 229), (1083, 229), (1081, 227), (1081, 226), (1081, 228), (1080, 229), (1079, 229), (1078, 228), (1077, 228), (1076, 227), (1076, 218), (1075, 217), (1075, 214), (1073, 214), (1072, 213), (1072, 212), (1071, 211), (1071, 209), (1068, 206), (1068, 205), (1067, 205), (1065, 203), (1065, 200), (1064, 200), (1062, 198), (1062, 197), (1061, 196), (1061, 195), (1060, 196), (1059, 195)] , 
    [(1037, 445 ), (1037, 446), (1036, 447), (1036, 448), (1034, 450), (1034, 452), (1033, 453), (1033, 454), (1032, 455), (1032, 457), (1030, 459), (1030, 460), (1029, 461), (1029, 462), (1028, 463), (1028, 464), (1027, 465), (1027, 466), (1026, 467), (1026, 468), (1025, 469), (1025, 471), (1024, 472), (1024, 473), (1023, 474), (1023, 476), (1021, 478), (1021, 479), (1020, 480), (1020, 481), (1019, 482), (1019, 483), (1018, 484), (1018, 486), (1016, 488), (1016, 490), (1014, 492), (1014, 494), (1013, 495), (1013, 496), (1012, 497), (1012, 498), (1011, 499), (1012, 500), (1014, 500), (1015, 501), (1017, 501), (1018, 502), (1020, 502), (1020, 500), (1023, 497), (1022, 496), (1022, 495), (1023, 494), (1024, 495), (1024, 493), (1025, 492), (1025, 485), (1026, 484), (1026, 483), (1028, 481), (1029, 481), (1030, 482), (1030, 481), (1029, 480), (1030, 479), (1030, 478), (1033, 475), (1033, 474), (1034, 473), (1034, 470), (1035, 469), (1035, 468), (1036, 467), (1036, 466), (1038, 464), (1038, 463), (1039, 462), (1039, 461), (1040, 460), (1040, 459), (1041, 458), (1041, 454), (1042, 453), (1041, 452), (1042, 451), (1042, 450), (1043, 449), (1042, 449), (1038, 445)] , 
    [(1103, 540), (1103, 541), (1101, 543), (1101, 544), (1100, 545), (1100, 546), (1098, 548), (1098, 549), (1097, 550), (1097, 551), (1095, 553), (1095, 554), (1094, 555), (1094, 558), (1095, 558), (1097, 560), (1098, 560), (1099, 559), (1100, 560), (1101, 560), (1101, 559), (1102, 558), (1103, 558), (1103, 553), (1104, 552), (1104, 549), (1106, 547), (1106, 546), (1107, 545), (1107, 544), (1108, 543), (1107, 542), (1106, 542), (1104, 540)] , 
    [(706, 288), (709, 291), (710, 291), (713, 294), (713, 296), (714, 296), (715, 297), (715, 300), (714, 301), (713, 301), (712, 302), (712, 304), (711, 305), (711, 311), (710, 312), (710, 314), (709, 315), (709, 318), (711, 316), (712, 316), (713, 317), (712, 318), (712, 319), (713, 318), (713, 317), (715, 315), (716, 315), (717, 314), (717, 313), (719, 311), (720, 312), (721, 312), (722, 311), (727, 311), (728, 312), (728, 313), (729, 314), (729, 316), (731, 318), (731, 321), (738, 321), (739, 320), (741, 320), (742, 321), (744, 321), (746, 323), (747, 323), (750, 326), (751, 326), (752, 327), (752, 329), (756, 333), (756, 332), (757, 331), (759, 331), (759, 330), (760, 329), (761, 330), (762, 330), (761, 329), (762, 328), (763, 328), (764, 327), (765, 328), (765, 323), (766, 322), (767, 323), (767, 328), (768, 327), (768, 325), (769, 324), (771, 324), (774, 321), (775, 321), (777, 319), (779, 319), (779, 318), (778, 317), (778, 315), (776, 315), (775, 316), (774, 316), (774, 318), (773, 319), (772, 319), (771, 318), (765, 318), (763, 316), (762, 316), (761, 315), (759, 315), (758, 314), (758, 313), (757, 312), (755, 312), (753, 314), (751, 312), (751, 311), (750, 310), (750, 309), (749, 308), (749, 304), (750, 303), (751, 304), (751, 302), (750, 302), (748, 300), (748, 299), (747, 300), (745, 300), (744, 301), (743, 301), (742, 302), (741, 302), (740, 303), (739, 303), (738, 304), (737, 303), (737, 301), (736, 300), (736, 299), (735, 298), (736, 297), (736, 294), (737, 293), (739, 293), (738, 293), (737, 292), (737, 291), (733, 291), (732, 292), (730, 290), (728, 290), (727, 289), (726, 289), (725, 288), (724, 289), (720, 289), (719, 288), (717, 288), (717, 292), (716, 293), (715, 292), (714, 292), (713, 291), (712, 291), (711, 290), (710, 290), (708, 288)] , 
    [(516, 195), (516, 197), (515, 198), (514, 198), (514, 199), (513, 200), (512, 200), (511, 199), (509, 199), (509, 200), (511, 202), (511, 203), (514, 203), (515, 202), (517, 202), (518, 203), (518, 205), (520, 205), (521, 206), (521, 207), (523, 209), (524, 209), (525, 210), (526, 209), (527, 210), (527, 211), (532, 211), (533, 212), (535, 212), (536, 213), (536, 214), (538, 214), (539, 215), (539, 216), (540, 217), (540, 216), (541, 215), (542, 215), (543, 216), (544, 216), (545, 217), (548, 217), (549, 218), (549, 219), (552, 219), (553, 220), (553, 221), (557, 217), (558, 217), (559, 216), (560, 217), (562, 217), (563, 216), (564, 216), (565, 215), (567, 215), (568, 214), (569, 215), (570, 214), (571, 214), (572, 213), (573, 213), (574, 212), (575, 213), (578, 213), (581, 216), (582, 215), (586, 215), (586, 214), (587, 213), (588, 214), (589, 214), (589, 213), (590, 212), (591, 212), (593, 210), (593, 209), (594, 208), (594, 207), (588, 207), (588, 208), (587, 209), (586, 208), (583, 208), (582, 207), (581, 207), (580, 206), (579, 206), (578, 205), (577, 206), (575, 206), (574, 205), (572, 205), (571, 206), (569, 204), (568, 204), (567, 205), (565, 205), (564, 204), (562, 204), (562, 205), (561, 206), (560, 205), (559, 205), (559, 206), (557, 208), (555, 206), (555, 207), (554, 208), (553, 208), (552, 207), (549, 207), (547, 205), (547, 203), (546, 203), (545, 202), (539, 202), (538, 201), (537, 202), (536, 201), (533, 201), (532, 200), (531, 200), (530, 199), (524, 199), (522, 197), (519, 197), (518, 196), (518, 195)] , 
    [(595, 109), (594, 110), (590, 110), (589, 111), (588, 111), (587, 112), (585, 112), (583, 114), (582, 114), (581, 115), (580, 115), (580, 118), (581, 119), (581, 120), (582, 121), (582, 123), (583, 124), (583, 127), (584, 128), (584, 131), (585, 132), (585, 134), (586, 135), (586, 137), (588, 139), (590, 139), (591, 140), (591, 141), (592, 142), (592, 143), (593, 144), (593, 146), (594, 147), (594, 150), (595, 151), (595, 153), (596, 154), (598, 154), (599, 153), (600, 153), (602, 151), (603, 151), (604, 150), (605, 150), (606, 149), (607, 149), (609, 147), (611, 147), (612, 148), (613, 148), (614, 149), (616, 149), (617, 148), (618, 148), (620, 146), (623, 146), (624, 147), (625, 147), (626, 148), (627, 148), (628, 147), (630, 147), (631, 148), (636, 148), (637, 149), (638, 149), (641, 152), (644, 152), (645, 151), (646, 152), (647, 152), (648, 153), (649, 153), (650, 154), (652, 154), (655, 157), (657, 157), (661, 153), (664, 153), (665, 152), (670, 152), (671, 153), (672, 153), (673, 154), (674, 154), (675, 155), (676, 155), (677, 154), (678, 154), (679, 155), (682, 155), (683, 156), (683, 158), (684, 158), (685, 159), (686, 159), (689, 162), (691, 162), (698, 169), (702, 169), (703, 168), (704, 168), (705, 167), (706, 167), (707, 166), (708, 166), (709, 165), (709, 161), (708, 160), (708, 159), (707, 159), (706, 158), (705, 158), (704, 157), (702, 157), (701, 156), (700, 156), (695, 151), (692, 151), (691, 150), (688, 150), (686, 148), (685, 148), (683, 146), (683, 145), (682, 145), (681, 144), (678, 144), (677, 143), (678, 142), (682, 142), (683, 143), (684, 143), (685, 144), (686, 144), (684, 142), (685, 141), (686, 141), (686, 134), (687, 133), (688, 133), (689, 132), (689, 131), (690, 130), (690, 129), (691, 128), (692, 128), (694, 126), (697, 126), (696, 126), (694, 124), (694, 123), (696, 121), (695, 121), (694, 120), (693, 121), (692, 121), (690, 123), (688, 123), (687, 122), (685, 122), (683, 120), (680, 120), (679, 119), (677, 119), (676, 118), (676, 116), (668, 116), (667, 115), (664, 115), (664, 116), (663, 117), (663, 122), (662, 123), (658, 123), (657, 124), (655, 124), (654, 125), (652, 125), (651, 126), (647, 126), (646, 127), (640, 127), (639, 128), (637, 128), (636, 129), (635, 129), (634, 130), (631, 130), (629, 132), (628, 132), (627, 133), (626, 133), (625, 134), (625, 135), (623, 137), (622, 137), (621, 138), (619, 138), (618, 139), (616, 139), (615, 138), (618, 135), (618, 134), (619, 133), (619, 131), (620, 130), (620, 128), (619, 127), (619, 126), (618, 125), (618, 122), (617, 122), (616, 121), (616, 120), (615, 119), (615, 116), (614, 116), (613, 115), (610, 115), (609, 114), (605, 114), (604, 115), (603, 115), (601, 113), (601, 110), (600, 109), (599, 109), (598, 110), (597, 110), (596, 109)] , 
    [(1261, 368), (1260, 369), (1256, 369), (1255, 370), (1254, 370), (1253, 371), (1252, 371), (1251, 372), (1247, 372), (1246, 373), (1245, 373), (1244, 374), (1239, 374), (1238, 373), (1237, 373), (1236, 374), (1233, 374), (1231, 376), (1228, 376), (1227, 375), (1227, 376), (1226, 377), (1225, 376), (1224, 376), (1223, 377), (1222, 377), (1221, 378), (1220, 378), (1218, 380), (1217, 380), (1216, 381), (1215, 381), (1214, 382), (1213, 382), (1213, 383), (1211, 385), (1210, 385), (1210, 386), (1212, 386), (1213, 385), (1214, 386), (1214, 387), (1215, 386), (1216, 387), (1218, 387), (1220, 385), (1223, 388), (1222, 389), (1223, 390), (1223, 391), (1226, 391), (1227, 390), (1228, 391), (1230, 391), (1232, 393), (1233, 392), (1234, 392), (1235, 391), (1235, 390), (1236, 389), (1237, 389), (1239, 387), (1242, 387), (1242, 386), (1243, 385), (1245, 385), (1247, 383), (1248, 383), (1249, 382), (1250, 382), (1250, 381), (1254, 377), (1255, 378), (1261, 378), (1263, 376), (1264, 376), (1264, 370), (1263, 369), (1263, 368)] , 
    [(1182, 318), (1183, 318), (1184, 319), (1184, 320), (1183, 321), (1178, 321), (1177, 322), (1170, 322), (1169, 321), (1167, 321), (1166, 320), (1163, 320), (1162, 321), (1161, 321), (1160, 320), (1146, 320), (1145, 319), (1144, 319), (1144, 320), (1143, 321), (1143, 322), (1142, 323), (1140, 323), (1142, 323), (1143, 324), (1143, 325), (1142, 326), (1137, 326), (1136, 327), (1135, 327), (1135, 328), (1136, 329), (1136, 330), (1137, 331), (1137, 333), (1138, 334), (1138, 335), (1139, 336), (1139, 339), (1141, 341), (1141, 342), (1141, 340), (1139, 338), (1140, 337), (1141, 337), (1142, 338), (1143, 337), (1143, 335), (1142, 334), (1142, 332), (1143, 331), (1144, 331), (1144, 330), (1147, 327), (1152, 327), (1153, 326), (1158, 326), (1159, 327), (1160, 327), (1161, 328), (1161, 329), (1162, 328), (1163, 328), (1164, 327), (1165, 328), (1166, 327), (1169, 327), (1170, 328), (1171, 328), (1172, 329), (1176, 329), (1177, 330), (1179, 330), (1180, 331), (1183, 331), (1184, 332), (1184, 335), (1181, 338), (1180, 338), (1180, 341), (1176, 345), (1176, 349), (1175, 350), (1175, 351), (1174, 352), (1174, 353), (1176, 355), (1176, 356), (1176, 355), (1177, 354), (1178, 354), (1179, 353), (1179, 350), (1180, 349), (1182, 349), (1182, 348), (1183, 347), (1184, 347), (1185, 348), (1186, 348), (1187, 347), (1188, 347), (1188, 345), (1189, 344), (1189, 342), (1190, 341), (1189, 340), (1189, 339), (1190, 338), (1191, 338), (1193, 340), (1196, 337), (1197, 338), (1198, 337), (1199, 337), (1200, 336), (1201, 337), (1202, 336), (1202, 335), (1201, 334), (1201, 329), (1203, 327), (1204, 327), (1204, 325), (1205, 324), (1209, 324), (1209, 323), (1210, 322), (1209, 322), (1207, 320), (1208, 319), (1208, 318), (1205, 318), (1204, 319), (1202, 319), (1201, 320), (1193, 320), (1192, 319), (1191, 320), (1190, 320), (1189, 319), (1187, 321), (1184, 318)] , 
    [(1751, 401), (1749, 403), (1748, 402), (1747, 402), (1747, 403), (1745, 405), (1744, 404), (1742, 404), (1741, 405), (1740, 405), (1738, 407), (1734, 407), (1732, 409), (1731, 408), (1730, 408), (1729, 409), (1725, 409), (1724, 408), (1723, 409), (1722, 409), (1722, 411), (1724, 413), (1723, 414), (1723, 415), (1722, 416), (1724, 416), (1725, 417), (1724, 418), (1724, 420), (1725, 421), (1725, 423), (1726, 423), (1727, 422), (1728, 423), (1729, 422), (1730, 423), (1732, 423), (1732, 422), (1733, 421), (1734, 422), (1734, 423), (1735, 424), (1737, 424), (1738, 425), (1739, 425), (1740, 426), (1741, 425), (1742, 426), (1743, 426), (1744, 427), (1745, 427), (1745, 426), (1744, 425), (1744, 423), (1745, 422), (1746, 423), (1748, 421), (1749, 421), (1750, 422), (1754, 422), (1755, 423), (1757, 423), (1758, 422), (1759, 423), (1760, 422), (1760, 421), (1761, 420), (1762, 420), (1763, 421), (1764, 420), (1764, 417), (1765, 416), (1765, 415), (1768, 412), (1769, 412), (1769, 410), (1768, 409), (1768, 407), (1767, 407), (1766, 406), (1764, 406), (1763, 407), (1762, 406), (1762, 404), (1761, 403), (1761, 402), (1760, 401), (1755, 401), (1754, 402), (1753, 402), (1752, 401)] , 
    [(1669, 555), (1668, 556), (1664, 556), (1663, 557), (1659, 557), (1660, 558), (1659, 559), (1659, 561), (1663, 565), (1663, 566), (1664, 567), (1664, 568), (1666, 570), (1668, 570), (1669, 571), (1670, 571), (1671, 572), (1672, 572), (1673, 573), (1675, 573), (1676, 574), (1678, 574), (1679, 575), (1681, 575), (1682, 576), (1687, 576), (1688, 577), (1689, 577), (1690, 578), (1692, 578), (1693, 579), (1693, 580), (1696, 580), (1697, 579), (1698, 580), (1698, 581), (1699, 581), (1700, 580), (1701, 581), (1703, 581), (1704, 582), (1705, 582), (1706, 583), (1706, 584), (1707, 584), (1708, 585), (1713, 585), (1714, 586), (1716, 586), (1717, 587), (1718, 587), (1719, 586), (1720, 587), (1721, 586), (1723, 586), (1724, 585), (1728, 585), (1729, 584), (1726, 581), (1726, 580), (1728, 578), (1729, 579), (1729, 578), (1730, 577), (1734, 577), (1733, 576), (1733, 575), (1732, 575), (1731, 574), (1732, 573), (1731, 573), (1730, 574), (1729, 573), (1729, 571), (1728, 571), (1726, 569), (1725, 569), (1724, 568), (1720, 568), (1719, 567), (1718, 567), (1717, 568), (1716, 567), (1715, 567), (1714, 566), (1710, 566), (1709, 565), (1708, 565), (1707, 566), (1706, 566), (1704, 564), (1702, 564), (1700, 562), (1698, 562), (1697, 561), (1693, 561), (1692, 560), (1690, 560), (1689, 559), (1686, 559), (1685, 558), (1683, 558), (1682, 557), (1677, 557), (1676, 556), (1673, 556), (1672, 555), (1671, 556), (1670, 555)] , 
    ]
    
    # first and last are the critical regions
       # [(595, 109), (594, 110), (590, 110), (589, 111), (588, 111), (587, 112), (585, 112), (583, 114), (582, 114), (581, 115), (580, 115), (580, 118), (581, 119), (581, 120), (582, 121), (582, 123), (583, 124), (583, 127), (584, 128), (584, 131), (585, 132), (585, 134), (586, 135), (586, 137), (588, 139), (590, 139), (591, 140), (591, 141), (592, 142), (592, 143), (593, 144), (593, 146), (594, 147), (594, 150), (595, 151), (595, 153), (596, 154), (598, 154), (599, 153), (600, 153), (602, 151), (603, 151), (604, 150), (605, 150), (606, 149), (607, 149), (609, 147), (611, 147), (612, 148), (613, 148), (614, 149), (616, 149), (617, 148), (618, 148), (620, 146), (623, 146), (624, 147), (625, 147), (626, 148), (627, 148), (628, 147), (630, 147), (631, 148), (636, 148), (637, 149), (638, 149), (641, 152), (644, 152), (645, 151), (646, 152), (647, 152), (648, 153), (649, 153), (650, 154), (652, 154), (655, 157), (657, 157), (661, 153), (664, 153), (665, 152), (670, 152), (671, 153), (672, 153), (673, 154), (674, 154), (675, 155), (676, 155), (677, 154), (678, 154), (679, 155), (682, 155), (683, 156), (683, 158), (684, 158), (685, 159), (686, 159), (689, 162), (691, 162), (698, 169), (702, 169), (703, 168), (704, 168), (705, 167), (706, 167), (707, 166), (708, 166), (709, 165), (709, 161), (708, 160), (708, 159), (707, 159), (706, 158), (705, 158), (704, 157), (702, 157), (701, 156), (700, 156), (695, 151), (692, 151), (691, 150), (688, 150), (686, 148), (685, 148), (683, 146), (683, 145), (682, 145), (681, 144), (678, 144), (677, 143), (678, 142), (682, 142), (683, 143), (684, 143), (685, 144), (686, 144), (684, 142), (685, 141), (686, 141), (686, 134), (687, 133), (688, 133), (689, 132), (689, 131), (690, 130), (690, 129), (691, 128), (692, 128), (694, 126), (697, 126), (696, 126), (694, 124), (694, 123), (696, 121), (695, 121), (694, 120), (693, 121), (692, 121), (690, 123), (688, 123), (687, 122), (685, 122), (683, 120), (680, 120), (679, 119), (677, 119), (676, 118), (676, 116), (668, 116), (667, 115), (664, 115), (664, 116), (663, 117), (663, 122), (662, 123), (658, 123), (657, 124), (655, 124), (654, 125), (652, 125), (651, 126), (647, 126), (646, 127), (640, 127), (639, 128), (637, 128), (636, 129), (635, 129), (634, 130), (631, 130), (629, 132), (628, 132), (627, 133), (626, 133), (625, 134), (625, 135), (623, 137), (622, 137), (621, 138), (619, 138), (618, 139), (616, 139), (615, 138), (618, 135), (618, 134), (619, 133), (619, 131), (620, 130), (620, 128), (619, 127), (619, 126), (618, 125), (618, 122), (617, 122), (616, 121), (616, 120), (615, 119), (615, 116), (614, 116), (613, 115), (610, 115), (609, 114), (605, 114), (604, 115), (603, 115), (601, 113), (601, 110), (600, 109), (599, 109), (598, 110), (597, 110), (596, 109)] , 
    # [(1751, 401), (1749, 403), (1748, 402), (1747, 402), (1747, 403), (1745, 405), (1744, 404), (1742, 404), (1741, 405), (1740, 405), (1738, 407), (1734, 407), (1732, 409), (1731, 408), (1730, 408), (1729, 409), (1725, 409), (1724, 408), (1723, 409), (1722, 409), (1722, 411), (1724, 413), (1723, 414), (1723, 415), (1722, 416), (1724, 416), (1725, 417), (1724, 418), (1724, 420), (1725, 421), (1725, 423), (1726, 423), (1727, 422), (1728, 423), (1729, 422), (1730, 423), (1732, 423), (1732, 422), (1733, 421), (1734, 422), (1734, 423), (1735, 424), (1737, 424), (1738, 425), (1739, 425), (1740, 426), (1741, 425), (1742, 426), (1743, 426), (1744, 427), (1745, 427), (1745, 426), (1744, 425), (1744, 423), (1745, 422), (1746, 423), (1748, 421), (1749, 421), (1750, 422), (1754, 422), (1755, 423), (1757, 423), (1758, 422), (1759, 423), (1760, 422), (1760, 421), (1761, 420), (1762, 420), (1763, 421), (1764, 420), (1764, 417), (1765, 416), (1765, 415), (1768, 412), (1769, 412), (1769, 410), (1768, 409), (1768, 407), (1767, 407), (1766, 406), (1764, 406), (1763, 407), (1762, 406), (1762, 404), (1761, 403), (1761, 402), (1760, 401), (1755, 401), (1754, 402), (1753, 402), (1752, 401)] , 
    # [(565, 163), (564, 164), (562, 164), (561, 165), (560, 165), (559, 164), (558, 165), (559, 166), (559, 167), (560, 168), (560, 171), (561, 172), (561, 173), (564, 176), (564, 181), (567, 181), (569, 183), (570, 183), (571, 184), (571, 185), (573, 187), (573, 188), (574, 189), (576, 189), (577, 188), (585, 188), (585, 184), (586, 183), (587, 183), (587, 182), (586, 181), (585, 182), (584, 182), (583, 181), (583, 179), (582, 180), (579, 177), (579, 175), (580, 174), (580, 172), (579, 171), (579, 170), (578, 170), (573, 165), (566, 165), (565, 164)] , 
    # [(516, 195), (516, 197), (515, 198), (514, 198), (514, 199), (513, 200), (512, 200), (511, 199), (509, 199), (509, 200), (511, 202), (511, 203), (514, 203), (515, 202), (517, 202), (518, 203), (518, 205), (520, 205), (521, 206), (521, 207), (523, 209), (524, 209), (525, 210), (526, 209), (527, 210), (527, 211), (532, 211), (533, 212), (535, 212), (536, 213), (536, 214), (538, 214), (539, 215), (539, 216), (540, 217), (540, 216), (541, 215), (542, 215), (543, 216), (544, 216), (545, 217), (548, 217), (549, 218), (549, 219), (552, 219), (553, 220), (553, 221), (557, 217), (558, 217), (559, 216), (560, 217), (562, 217), (563, 216), (564, 216), (565, 215), (567, 215), (568, 214), (569, 215), (570, 214), (571, 214), (572, 213), (573, 213), (574, 212), (575, 213), (578, 213), (581, 216), (582, 215), (586, 215), (586, 214), (587, 213), (588, 214), (589, 214), (589, 213), (590, 212), (591, 212), (593, 210), (593, 209), (594, 208), (594, 207), (588, 207), (588, 208), (587, 209), (586, 208), (583, 208), (582, 207), (581, 207), (580, 206), (579, 206), (578, 205), (577, 206), (575, 206), (574, 205), (572, 205), (571, 206), (569, 204), (568, 204), (567, 205), (565, 205), (564, 204), (562, 204), (562, 205), (561, 206), (560, 205), (559, 205), (559, 206), (557, 208), (555, 206), (555, 207), (554, 208), (553, 208), (552, 207), (549, 207), (547, 205), (547, 203), (546, 203), (545, 202), (539, 202), (538, 201), (537, 202), (536, 201), (533, 201), (532, 200), (531, 200), (530, 199), (524, 199), (522, 197), (519, 197), (518, 196), (518, 195)] , 
    # [(706, 288), (709, 291), (710, 291), (713, 294), (713, 296), (714, 296), (715, 297), (715, 300), (714, 301), (713, 301), (712, 302), (712, 304), (711, 305), (711, 311), (710, 312), (710, 314), (709, 315), (709, 318), (711, 316), (712, 316), (713, 317), (712, 318), (712, 319), (713, 318), (713, 317), (715, 315), (716, 315), (717, 314), (717, 313), (719, 311), (720, 312), (721, 312), (722, 311), (727, 311), (728, 312), (728, 313), (729, 314), (729, 316), (731, 318), (731, 321), (738, 321), (739, 320), (741, 320), (742, 321), (744, 321), (746, 323), (747, 323), (750, 326), (751, 326), (752, 327), (752, 329), (756, 333), (756, 332), (757, 331), (759, 331), (759, 330), (760, 329), (761, 330), (762, 330), (761, 329), (762, 328), (763, 328), (764, 327), (765, 328), (765, 323), (766, 322), (767, 323), (767, 328), (768, 327), (768, 325), (769, 324), (771, 324), (774, 321), (775, 321), (777, 319), (779, 319), (779, 318), (778, 317), (778, 315), (776, 315), (775, 316), (774, 316), (774, 318), (773, 319), (772, 319), (771, 318), (765, 318), (763, 316), (762, 316), (761, 315), (759, 315), (758, 314), (758, 313), (757, 312), (755, 312), (753, 314), (751, 312), (751, 311), (750, 310), (750, 309), (749, 308), (749, 304), (750, 303), (751, 304), (751, 302), (750, 302), (748, 300), (748, 299), (747, 300), (745, 300), (744, 301), (743, 301), (742, 302), (741, 302), (740, 303), (739, 303), (738, 304), (737, 303), (737, 301), (736, 300), (736, 299), (735, 298), (736, 297), (736, 294), (737, 293), (739, 293), (738, 293), (737, 292), (737, 291), (733, 291), (732, 292), (730, 290), (728, 290), (727, 289), (726, 289), (725, 288), (724, 289), (720, 289), (719, 288), (717, 288), (717, 292), (716, 293), (715, 292), (714, 292), (713, 291), (712, 291), (711, 290), (710, 290), (708, 288)] , 
     # [(1669, 555), (1668, 556), (1664, 556), (1663, 557), (1659, 557), (1660, 558), (1659, 559), (1659, 561), (1663, 565), (1663, 566), (1664, 567), (1664, 568), (1666, 570), (1668, 570), (1669, 571), (1670, 571), (1671, 572), (1672, 572), (1673, 573), (1675, 573), (1676, 574), (1678, 574), (1679, 575), (1681, 575), (1682, 576), (1687, 576), (1688, 577), (1689, 577), (1690, 578), (1692, 578), (1693, 579), (1693, 580), (1696, 580), (1697, 579), (1698, 580), (1698, 581), (1699, 581), (1700, 580), (1701, 581), (1703, 581), (1704, 582), (1705, 582), (1706, 583), (1706, 584), (1707, 584), (1708, 585), (1713, 585), (1714, 586), (1716, 586), (1717, 587), (1718, 587), (1719, 586), (1720, 587), (1721, 586), (1723, 586), (1724, 585), (1728, 585), (1729, 584), (1726, 581), (1726, 580), (1728, 578), (1729, 579), (1729, 578), (1730, 577), (1734, 577), (1733, 576), (1733, 575), (1732, 575), (1731, 574), (1732, 573), (1731, 573), (1730, 574), (1729, 573), (1729, 571), (1728, 571), (1726, 569), (1725, 569), (1724, 568), (1720, 568), (1719, 567), (1718, 567), (1717, 568), (1716, 567), (1715, 567), (1714, 566), (1710, 566), (1709, 565), (1708, 565), (1707, 566), (1706, 566), (1704, 564), (1702, 564), (1700, 562), (1698, 562), (1697, 561), (1693, 561), (1692, 560), (1690, 560), (1689, 559), (1686, 559), (1685, 558), (1683, 558), (1682, 557), (1677, 557), (1676, 556), (1673, 556), (1672, 555), (1671, 556), (1670, 555)] , 
    

    # coordinates = [[(237, 477), (234, 480), (233, 480), (233, 484), (230, 487), (230, 490), (231, 491), (231, 492), (232, 492), (233, 493), (233, 499), (231, 501), (230, 501), (229, 500), (229, 501), (227, 503), (228, 504), (228, 506), (229, 505), (230, 505), (231, 506), (230, 507), (230, 508), (229, 509), (229, 510), (228, 511), (227, 510), (226, 511), (227, 511), (228, 512), (227, 513), (224, 513), (224, 514), (223, 515), (223, 517), (224, 518), (223, 519), (223, 521), (222, 522), (221, 521), (221, 520), (220, 521), (220, 523), (219, 524), (219, 526), (220, 527), (220, 528), (221, 529), (221, 531), (222, 532), (222, 534), (223, 535), (224, 534), (225, 534), (226, 535), (227, 535), (227, 534), (228, 533), (229, 534), (229, 535), (230, 536), (230, 534), (232, 532), (233, 533), (233, 536), (232, 537), (233, 537), (234, 538), (237, 535), (238, 536), (239, 536), (240, 537), (241, 537), (242, 536), (244, 536), (244, 535), (246, 533), (247, 533), (248, 532), (248, 531), (250, 529), (250, 528), (252, 526), (253, 526), (254, 527), (254, 528), (255, 529), (256, 529), (257, 530), (257, 533), (258, 534), (262, 534), (263, 535), (263, 537), (264, 536), (264, 532), (263, 533), (260, 533), (259, 532), (259, 531), (258, 530), (258, 528), (259, 527), (260, 528), (261, 527), (262, 527), (262, 526), (260, 526), (259, 525), (258, 525), (257, 524), (257, 523), (258, 522), (258, 520), (257, 520), (256, 521), (252, 521), (251, 520), (251, 519), (250, 518), (250, 517), (251, 516), (251, 515), (250, 514), (250, 512), (249, 511), (249, 509), (248, 509), (247, 508), (247, 506), (244, 503), (244, 501), (243, 500), (242, 501), (241, 500), (241, 498), (240, 497), (240, 493), (239, 492), (239, 490), (238, 489), (238, 486), (237, 485), (237, 481), (238, 480), (238, 478)] , 
    # [(595, 109), (594, 110), (590, 110), (589, 111), (588, 111), (587, 112), (585, 112), (583, 114), (582, 114), (581, 115), (580, 115), (580, 118), (581, 119), (581, 120), (582, 121), (582, 123), (583, 124), (583, 127), (584, 128), (584, 131), (585, 132), (585, 134), (586, 135), (586, 137), (588, 139), (590, 139), (591, 140), (591, 141), (592, 142), (592, 143), (593, 144), (593, 146), (594, 147), (594, 150), (595, 151), (595, 153), (596, 154), (598, 154), (599, 153), (600, 153), (602, 151), (603, 151), (604, 150), (605, 150), (606, 149), (607, 149), (609, 147), (611, 147), (612, 148), (613, 148), (614, 149), (616, 149), (617, 148), (618, 148), (620, 146), (623, 146), (624, 147), (625, 147), (626, 148), (627, 148), (628, 147), (630, 147), (631, 148), (636, 148), (637, 149), (638, 149), (641, 152), (644, 152), (645, 151), (646, 152), (647, 152), (648, 153), (649, 153), (650, 154), (652, 154), (655, 157), (657, 157), (661, 153), (664, 153), (665, 152), (670, 152), (671, 153), (672, 153), (673, 154), (674, 154), (675, 155), (676, 155), (677, 154), (678, 154), (679, 155), (682, 155), (683, 156), (683, 158), (684, 158), (685, 159), (686, 159), (689, 162), (691, 162), (698, 169), (702, 169), (703, 168), (704, 168), (705, 167), (706, 167), (707, 166), (708, 166), (709, 165), (709, 161), (708, 160), (708, 159), (707, 159), (706, 158), (705, 158), (704, 157), (702, 157), (701, 156), (700, 156), (695, 151), (692, 151), (691, 150), (688, 150), (686, 148), (685, 148), (683, 146), (683, 145), (682, 145), (681, 144), (678, 144), (677, 143), (678, 142), (682, 142), (683, 143), (684, 143), (685, 144), (686, 144), (684, 142), (685, 141), (686, 141), (686, 134), (687, 133), (688, 133), (689, 132), (689, 131), (690, 130), (690, 129), (691, 128), (692, 128), (694, 126), (697, 126), (696, 126), (694, 124), (694, 123), (696, 121), (695, 121), (694, 120), (693, 121), (692, 121), (690, 123), (688, 123), (687, 122), (685, 122), (683, 120), (680, 120), (679, 119), (677, 119), (676, 118), (676, 116), (668, 116), (667, 115), (664, 115), (664, 116), (663, 117), (663, 122), (662, 123), (658, 123), (657, 124), (655, 124), (654, 125), (652, 125), (651, 126), (647, 126), (646, 127), (640, 127), (639, 128), (637, 128), (636, 129), (635, 129), (634, 130), (631, 130), (629, 132), (628, 132), (627, 133), (626, 133), (625, 134), (625, 135), (623, 137), (622, 137), (621, 138), (619, 138), (618, 139), (616, 139), (615, 138), (618, 135), (618, 134), (619, 133), (619, 131), (620, 130), (620, 128), (619, 127), (619, 126), (618, 125), (618, 122), (617, 122), (616, 121), (616, 120), (615, 119), (615, 116), (614, 116), (613, 115), (610, 115), (609, 114), (605, 114), (604, 115), (603, 115), (601, 113), (601, 110), (600, 109), (599, 109), (598, 110), (597, 110), (596, 109)] , 
    # [(1751, 401), (1749, 403), (1748, 402), (1747, 402), (1747, 403), (1745, 405), (1744, 404), (1742, 404), (1741, 405), (1740, 405), (1738, 407), (1734, 407), (1732, 409), (1731, 408), (1730, 408), (1729, 409), (1725, 409), (1724, 408), (1723, 409), (1722, 409), (1722, 411), (1724, 413), (1723, 414), (1723, 415), (1722, 416), (1724, 416), (1725, 417), (1724, 418), (1724, 420), (1725, 421), (1725, 423), (1726, 423), (1727, 422), (1728, 423), (1729, 422), (1730, 423), (1732, 423), (1732, 422), (1733, 421), (1734, 422), (1734, 423), (1735, 424), (1737, 424), (1738, 425), (1739, 425), (1740, 426), (1741, 425), (1742, 426), (1743, 426), (1744, 427), (1745, 427), (1745, 426), (1744, 425), (1744, 423), (1745, 422), (1746, 423), (1748, 421), (1749, 421), (1750, 422), (1754, 422), (1755, 423), (1757, 423), (1758, 422), (1759, 423), (1760, 422), (1760, 421), (1761, 420), (1762, 420), (1763, 421), (1764, 420), (1764, 417), (1765, 416), (1765, 415), (1768, 412), (1769, 412), (1769, 410), (1768, 409), (1768, 407), (1767, 407), (1766, 406), (1764, 406), (1763, 407), (1762, 406), (1762, 404), (1761, 403), (1761, 402), (1760, 401), (1755, 401), (1754, 402), (1753, 402), (1752, 401)] , 
    # # # [(644, 210), (643, 211), (644, 212), (643, 213), (643, 214), (644, 215), (644, 218), (645, 219), (645, 221), (646, 222), (646, 223), (647, 224), (648, 224), (652, 228), (653, 228), (654, 229), (656, 229), (657, 228), (658, 229), (658, 230), (659, 230), (662, 233), (662, 234), (664, 234), (665, 233), (667, 233), (668, 232), (669, 232), (671, 230), (672, 230), (673, 229), (674, 229), (675, 228), (676, 228), (676, 227), (677, 226), (679, 226), (681, 224), (681, 223), (682, 222), (682, 220), (683, 219), (682, 219), (681, 218), (672, 218), (672, 220), (671, 221), (668, 221), (667, 222), (666, 221), (662, 221), (661, 220), (661, 219), (660, 219), (658, 217), (656, 217), (655, 216), (654, 216), (653, 217), (652, 216), (652, 214), (653, 213), (653, 212), (652, 213), (651, 212), (647, 212), (645, 210)] , 
    # [(565, 163), (564, 164), (562, 164), (561, 165), (560, 165), (559, 164), (558, 165), (559, 166), (559, 167), (560, 168), (560, 171), (561, 172), (561, 173), (564, 176), (564, 181), (567, 181), (569, 183), (570, 183), (571, 184), (571, 185), (573, 187), (573, 188), (574, 189), (576, 189), (577, 188), (585, 188), (585, 184), (586, 183), (587, 183), (587, 182), (586, 181), (585, 182), (584, 182), (583, 181), (583, 179), (582, 180), (579, 177), (579, 175), (580, 174), (580, 172), (579, 171), (579, 170), (578, 170), (573, 165), (566, 165), (565, 164)] , 
    # [(516, 195), (516, 197), (515, 198), (514, 198), (514, 199), (513, 200), (512, 200), (511, 199), (509, 199), (509, 200), (511, 202), (511, 203), (514, 203), (515, 202), (517, 202), (518, 203), (518, 205), (520, 205), (521, 206), (521, 207), (523, 209), (524, 209), (525, 210), (526, 209), (527, 210), (527, 211), (532, 211), (533, 212), (535, 212), (536, 213), (536, 214), (538, 214), (539, 215), (539, 216), (540, 217), (540, 216), (541, 215), (542, 215), (543, 216), (544, 216), (545, 217), (548, 217), (549, 218), (549, 219), (552, 219), (553, 220), (553, 221), (557, 217), (558, 217), (559, 216), (560, 217), (562, 217), (563, 216), (564, 216), (565, 215), (567, 215), (568, 214), (569, 215), (570, 214), (571, 214), (572, 213), (573, 213), (574, 212), (575, 213), (578, 213), (581, 216), (582, 215), (586, 215), (586, 214), (587, 213), (588, 214), (589, 214), (589, 213), (590, 212), (591, 212), (593, 210), (593, 209), (594, 208), (594, 207), (588, 207), (588, 208), (587, 209), (586, 208), (583, 208), (582, 207), (581, 207), (580, 206), (579, 206), (578, 205), (577, 206), (575, 206), (574, 205), (572, 205), (571, 206), (569, 204), (568, 204), (567, 205), (565, 205), (564, 204), (562, 204), (562, 205), (561, 206), (560, 205), (559, 205), (559, 206), (557, 208), (555, 206), (555, 207), (554, 208), (553, 208), (552, 207), (549, 207), (547, 205), (547, 203), (546, 203), (545, 202), (539, 202), (538, 201), (537, 202), (536, 201), (533, 201), (532, 200), (531, 200), (530, 199), (524, 199), (522, 197), (519, 197), (518, 196), (518, 195)] , 
    # [(706, 288), (709, 291), (710, 291), (713, 294), (713, 296), (714, 296), (715, 297), (715, 300), (714, 301), (713, 301), (712, 302), (712, 304), (711, 305), (711, 311), (710, 312), (710, 314), (709, 315), (709, 318), (711, 316), (712, 316), (713, 317), (712, 318), (712, 319), (713, 318), (713, 317), (715, 315), (716, 315), (717, 314), (717, 313), (719, 311), (720, 312), (721, 312), (722, 311), (727, 311), (728, 312), (728, 313), (729, 314), (729, 316), (731, 318), (731, 321), (738, 321), (739, 320), (741, 320), (742, 321), (744, 321), (746, 323), (747, 323), (750, 326), (751, 326), (752, 327), (752, 329), (756, 333), (756, 332), (757, 331), (759, 331), (759, 330), (760, 329), (761, 330), (762, 330), (761, 329), (762, 328), (763, 328), (764, 327), (765, 328), (765, 323), (766, 322), (767, 323), (767, 328), (768, 327), (768, 325), (769, 324), (771, 324), (774, 321), (775, 321), (777, 319), (779, 319), (779, 318), (778, 317), (778, 315), (776, 315), (775, 316), (774, 316), (774, 318), (773, 319), (772, 319), (771, 318), (765, 318), (763, 316), (762, 316), (761, 315), (759, 315), (758, 314), (758, 313), (757, 312), (755, 312), (753, 314), (751, 312), (751, 311), (750, 310), (750, 309), (749, 308), (749, 304), (750, 303), (751, 304), (751, 302), (750, 302), (748, 300), (748, 299), (747, 300), (745, 300), (744, 301), (743, 301), (742, 302), (741, 302), (740, 303), (739, 303), (738, 304), (737, 303), (737, 301), (736, 300), (736, 299), (735, 298), (736, 297), (736, 294), (737, 293), (739, 293), (738, 293), (737, 292), (737, 291), (733, 291), (732, 292), (730, 290), (728, 290), (727, 289), (726, 289), (725, 288), (724, 289), (720, 289), (719, 288), (717, 288), (717, 292), (716, 293), (715, 292), (714, 292), (713, 291), (712, 291), (711, 290), (710, 290), (708, 288)] , 
    # [(1037, 445 ), (1037, 446), (1036, 447), (1036, 448), (1034, 450), (1034, 452), (1033, 453), (1033, 454), (1032, 455), (1032, 457), (1030, 459), (1030, 460), (1029, 461), (1029, 462), (1028, 463), (1028, 464), (1027, 465), (1027, 466), (1026, 467), (1026, 468), (1025, 469), (1025, 471), (1024, 472), (1024, 473), (1023, 474), (1023, 476), (1021, 478), (1021, 479), (1020, 480), (1020, 481), (1019, 482), (1019, 483), (1018, 484), (1018, 486), (1016, 488), (1016, 490), (1014, 492), (1014, 494), (1013, 495), (1013, 496), (1012, 497), (1012, 498), (1011, 499), (1012, 500), (1014, 500), (1015, 501), (1017, 501), (1018, 502), (1020, 502), (1020, 500), (1023, 497), (1022, 496), (1022, 495), (1023, 494), (1024, 495), (1024, 493), (1025, 492), (1025, 485), (1026, 484), (1026, 483), (1028, 481), (1029, 481), (1030, 482), (1030, 481), (1029, 480), (1030, 479), (1030, 478), (1033, 475), (1033, 474), (1034, 473), (1034, 470), (1035, 469), (1035, 468), (1036, 467), (1036, 466), (1038, 464), (1038, 463), (1039, 462), (1039, 461), (1040, 460), (1040, 459), (1041, 458), (1041, 454), (1042, 453), (1041, 452), (1042, 451), (1042, 450), (1043, 449), (1042, 449), (1038, 445)] , 
    # [(1261, 368), (1260, 369), (1256, 369), (1255, 370), (1254, 370), (1253, 371), (1252, 371), (1251, 372), (1247, 372), (1246, 373), (1245, 373), (1244, 374), (1239, 374), (1238, 373), (1237, 373), (1236, 374), (1233, 374), (1231, 376), (1228, 376), (1227, 375), (1227, 376), (1226, 377), (1225, 376), (1224, 376), (1223, 377), (1222, 377), (1221, 378), (1220, 378), (1218, 380), (1217, 380), (1216, 381), (1215, 381), (1214, 382), (1213, 382), (1213, 383), (1211, 385), (1210, 385), (1210, 386), (1212, 386), (1213, 385), (1214, 386), (1214, 387), (1215, 386), (1216, 387), (1218, 387), (1220, 385), (1223, 388), (1222, 389), (1223, 390), (1223, 391), (1226, 391), (1227, 390), (1228, 391), (1230, 391), (1232, 393), (1233, 392), (1234, 392), (1235, 391), (1235, 390), (1236, 389), (1237, 389), (1239, 387), (1242, 387), (1242, 386), (1243, 385), (1245, 385), (1247, 383), (1248, 383), (1249, 382), (1250, 382), (1250, 381), (1254, 377), (1255, 378), (1261, 378), (1263, 376), (1264, 376), (1264, 370), (1263, 369), (1263, 368)] , 
    # [(1217, 464), (1216, 465), (1206, 465), (1205, 466), (1204, 465), (1203, 466), (1201, 466), (1197, 470), (1196, 470), (1195, 471), (1194, 471), (1193, 470), (1188, 470), (1187, 469), (1185, 469), (1184, 468), (1177, 468), (1176, 467), (1174, 467), (1175, 467), (1178, 470), (1179, 470), (1181, 472), (1180, 473), (1182, 475), (1180, 477), (1182, 477), (1183, 478), (1184, 477), (1186, 477), (1187, 478), (1188, 477), (1190, 477), (1191, 476), (1195, 476), (1196, 477), (1196, 478), (1197, 477), (1198, 477), (1199, 478), (1200, 477), (1201, 477), (1202, 476), (1207, 476), (1208, 475), (1214, 475), (1215, 474), (1222, 474), (1223, 473), (1224, 473), (1225, 474), (1225, 475), (1226, 475), (1226, 474), (1225, 473), (1225, 468), (1226, 467), (1224, 467), (1223, 466), (1224, 465), (1226, 465), (1227, 464), (1221, 464), (1220, 465), (1218, 465)] , 
    # [(1182, 318), (1183, 318), (1184, 319), (1184, 320), (1183, 321), (1178, 321), (1177, 322), (1170, 322), (1169, 321), (1167, 321), (1166, 320), (1163, 320), (1162, 321), (1161, 321), (1160, 320), (1146, 320), (1145, 319), (1144, 319), (1144, 320), (1143, 321), (1143, 322), (1142, 323), (1140, 323), (1142, 323), (1143, 324), (1143, 325), (1142, 326), (1137, 326), (1136, 327), (1135, 327), (1135, 328), (1136, 329), (1136, 330), (1137, 331), (1137, 333), (1138, 334), (1138, 335), (1139, 336), (1139, 339), (1141, 341), (1141, 342), (1141, 340), (1139, 338), (1140, 337), (1141, 337), (1142, 338), (1143, 337), (1143, 335), (1142, 334), (1142, 332), (1143, 331), (1144, 331), (1144, 330), (1147, 327), (1152, 327), (1153, 326), (1158, 326), (1159, 327), (1160, 327), (1161, 328), (1161, 329), (1162, 328), (1163, 328), (1164, 327), (1165, 328), (1166, 327), (1169, 327), (1170, 328), (1171, 328), (1172, 329), (1176, 329), (1177, 330), (1179, 330), (1180, 331), (1183, 331), (1184, 332), (1184, 335), (1181, 338), (1180, 338), (1180, 341), (1176, 345), (1176, 349), (1175, 350), (1175, 351), (1174, 352), (1174, 353), (1176, 355), (1176, 356), (1176, 355), (1177, 354), (1178, 354), (1179, 353), (1179, 350), (1180, 349), (1182, 349), (1182, 348), (1183, 347), (1184, 347), (1185, 348), (1186, 348), (1187, 347), (1188, 347), (1188, 345), (1189, 344), (1189, 342), (1190, 341), (1189, 340), (1189, 339), (1190, 338), (1191, 338), (1193, 340), (1196, 337), (1197, 338), (1198, 337), (1199, 337), (1200, 336), (1201, 337), (1202, 336), (1202, 335), (1201, 334), (1201, 329), (1203, 327), (1204, 327), (1204, 325), (1205, 324), (1209, 324), (1209, 323), (1210, 322), (1209, 322), (1207, 320), (1208, 319), (1208, 318), (1205, 318), (1204, 319), (1202, 319), (1201, 320), (1193, 320), (1192, 319), (1191, 320), (1190, 320), (1189, 319), (1187, 321), (1184, 318)] , 
    # # # [(971, 171), (971, 172), (970, 173), (970, 175), (971, 176), (969, 178), (970, 178), (971, 179), (971, 180), (972, 179), (973, 179), (974, 180), (975, 180), (977, 182), (978, 182), (979, 183), (980, 183), (981, 184), (981, 185), (984, 185), (985, 186), (986, 186), (987, 187), (988, 187), (989, 188), (990, 188), (993, 191), (994, 191), (995, 192), (995, 193), (996, 194), (996, 195), (998, 195), (1000, 193), (1001, 193), (1003, 191), (1004, 192), (1004, 191), (1005, 190), (1006, 190), (1008, 192), (1009, 191), (1010, 192), (1011, 191), (1012, 191), (1013, 192), (1015, 192), (1016, 191), (1017, 191), (1013, 191), (1011, 189), (1012, 188), (1011, 187), (1012, 186), (1012, 184), (1011, 183), (1011, 182), (1009, 184), (1008, 184), (1007, 183), (1003, 183), (1002, 182), (1001, 182), (1000, 181), (1001, 180), (1000, 180), (999, 179), (999, 178), (998, 177), (997, 177), (995, 175), (992, 175), (991, 174), (989, 174), (988, 173), (986, 173), (985, 174), (984, 174), (983, 173), (978, 173), (977, 172), (975, 172), (974, 173), (973, 172), (972, 172)] , 
    # # # [(654, 82), (653, 83), (652, 83), (652, 87), (651, 88), (648, 88), (648, 89), (647, 90), (645, 88), (642, 88), (640, 90), (640, 92), (639, 93), (637, 91), (631, 91), (630, 92), (626, 92), (625, 93), (624, 93), (622, 95), (621, 95), (620, 96), (620, 99), (621, 99), (622, 100), (622, 101), (623, 102), (623, 103), (625, 105), (625, 106), (627, 108), (630, 108), (631, 109), (632, 109), (634, 111), (634, 113), (635, 113), (636, 112), (637, 112), (638, 111), (639, 111), (639, 110), (641, 108), (642, 108), (643, 107), (644, 107), (645, 106), (649, 106), (650, 105), (650, 104), (652, 102), (654, 102), (654, 100), (661, 93), (661, 92), (662, 91), (661, 90), (661, 89), (660, 88), (661, 87), (660, 87), (659, 86), (659, 85), (658, 84), (658, 83), (657, 82)] , 
    # [(1669, 555), (1668, 556), (1664, 556), (1663, 557), (1659, 557), (1660, 558), (1659, 559), (1659, 561), (1663, 565), (1663, 566), (1664, 567), (1664, 568), (1666, 570), (1668, 570), (1669, 571), (1670, 571), (1671, 572), (1672, 572), (1673, 573), (1675, 573), (1676, 574), (1678, 574), (1679, 575), (1681, 575), (1682, 576), (1687, 576), (1688, 577), (1689, 577), (1690, 578), (1692, 578), (1693, 579), (1693, 580), (1696, 580), (1697, 579), (1698, 580), (1698, 581), (1699, 581), (1700, 580), (1701, 581), (1703, 581), (1704, 582), (1705, 582), (1706, 583), (1706, 584), (1707, 584), (1708, 585), (1713, 585), (1714, 586), (1716, 586), (1717, 587), (1718, 587), (1719, 586), (1720, 587), (1721, 586), (1723, 586), (1724, 585), (1728, 585), (1729, 584), (1726, 581), (1726, 580), (1728, 578), (1729, 579), (1729, 578), (1730, 577), (1734, 577), (1733, 576), (1733, 575), (1732, 575), (1731, 574), (1732, 573), (1731, 573), (1730, 574), (1729, 573), (1729, 571), (1728, 571), (1726, 569), (1725, 569), (1724, 568), (1720, 568), (1719, 567), (1718, 567), (1717, 568), (1716, 567), (1715, 567), (1714, 566), (1710, 566), (1709, 565), (1708, 565), (1707, 566), (1706, 566), (1704, 564), (1702, 564), (1700, 562), (1698, 562), (1697, 561), (1693, 561), (1692, 560), (1690, 560), (1689, 559), (1686, 559), (1685, 558), (1683, 558), (1682, 557), (1677, 557), (1676, 556), (1673, 556), (1672, 555), (1671, 556), (1670, 555)] , 
    # # # [(595, 108), (595, 109), (594, 110), (593, 110), (592, 109), (590, 109), (590, 110), (589, 111), (588, 111), (587, 112), (586, 112), (585, 111), (585, 112), (584, 113), (583, 113), (584, 113), (585, 114), (584, 115), (581, 115), (580, 114), (579, 115), (579, 117), (580, 118), (580, 119), (581, 120), (581, 121), (582, 122), (582, 125), (583, 126), (583, 129), (584, 130), (584, 132), (585, 133), (585, 135), (586, 136), (586, 137), (587, 138), (587, 139), (589, 139), (592, 142), (592, 143), (593, 144), (593, 147), (594, 148), (594, 155), (595, 156), (595, 158), (596, 158), (597, 159), (599, 157), (600, 157), (600, 156), (603, 153), (604, 153), (606, 151), (607, 151), (608, 150), (609, 151), (609, 150), (611, 148), (612, 149), (612, 150), (613, 149), (614, 150), (614, 151), (613, 152), (612, 152), (614, 152), (617, 149), (618, 149), (618, 148), (620, 146), (621, 146), (622, 147), (623, 146), (625, 148), (627, 148), (628, 147), (630, 147), (631, 148), (633, 148), (634, 149), (635, 148), (636, 148), (637, 149), (638, 149), (640, 151), (640, 152), (643, 152), (644, 153), (645, 153), (647, 155), (648, 155), (649, 156), (649, 155), (650, 154), (653, 154), (654, 155), (654, 157), (658, 157), (659, 158), (659, 155), (660, 154), (661, 154), (662, 153), (665, 153), (666, 152), (670, 152), (671, 153), (671, 154), (672, 155), (673, 155), (674, 156), (676, 156), (677, 155), (681, 155), (683, 157), (683, 158), (684, 158), (685, 159), (686, 159), (689, 162), (691, 162), (693, 164), (693, 165), (694, 165), (698, 169), (699, 169), (700, 170), (701, 170), (703, 168), (704, 168), (706, 166), (708, 166), (709, 165), (710, 165), (711, 164), (712, 164), (712, 163), (711, 162), (711, 158), (712, 157), (711, 156), (710, 157), (708, 157), (707, 158), (706, 157), (706, 155), (707, 154), (706, 154), (705, 155), (704, 155), (703, 154), (702, 154), (701, 153), (700, 153), (699, 152), (698, 152), (697, 153), (696, 152), (696, 151), (694, 151), (692, 149), (692, 148), (691, 147), (691, 146), (690, 145), (691, 144), (690, 143), (690, 141), (689, 140), (688, 140), (686, 138), (686, 136), (681, 136), (680, 135), (680, 134), (681, 133), (682, 133), (682, 132), (681, 131), (680, 131), (679, 130), (679, 127), (678, 127), (677, 126), (677, 124), (676, 123), (677, 122), (678, 122), (679, 123), (679, 122), (678, 121), (678, 119), (677, 119), (676, 118), (676, 117), (675, 116), (674, 117), (671, 117), (669, 115), (668, 116), (666, 114), (666, 113), (666, 114), (665, 115), (664, 114), (663, 115), (664, 116), (664, 118), (665, 119), (665, 120), (664, 121), (664, 123), (663, 124), (661, 124), (660, 123), (657, 123), (656, 124), (654, 124), (653, 125), (650, 125), (649, 126), (643, 126), (642, 127), (638, 127), (637, 128), (636, 128), (635, 129), (634, 129), (633, 130), (632, 129), (631, 130), (630, 130), (629, 131), (628, 130), (628, 123), (627, 123), (626, 122), (625, 122), (624, 121), (624, 119), (623, 118), (623, 116), (622, 117), (621, 117), (620, 116), (620, 115), (614, 115), (613, 114), (612, 115), (611, 115), (610, 114), (609, 114), (608, 113), (607, 113), (606, 112), (606, 111), (603, 111), (602, 110), (602, 109), (601, 109), (600, 108)] , 
    # [(1103, 540), (1103, 541), (1101, 543), (1101, 544), (1100, 545), (1100, 546), (1098, 548), (1098, 549), (1097, 550), (1097, 551), (1095, 553), (1095, 554), (1094, 555), (1094, 558), (1095, 558), (1097, 560), (1098, 560), (1099, 559), (1100, 560), (1101, 560), (1101, 559), (1102, 558), (1103, 558), (1103, 553), (1104, 552), (1104, 549), (1106, 547), (1106, 546), (1107, 545), (1107, 544), (1108, 543), (1107, 542), (1106, 542), (1104, 540)] , 
    # [(625, 225), (624, 226), (623, 226), (623, 227), (621, 229), (620, 228), (620, 227), (619, 226), (618, 227), (616, 227), (615, 228), (610, 228), (609, 227), (608, 227), (606, 229), (604, 229), (603, 230), (599, 230), (598, 229), (597, 229), (594, 232), (593, 232), (594, 233), (593, 234), (592, 234), (593, 235), (592, 236), (593, 237), (592, 238), (591, 238), (592, 238), (593, 239), (593, 240), (594, 240), (595, 241), (593, 243), (592, 243), (591, 244), (590, 244), (588, 242), (588, 241), (586, 241), (585, 240), (577, 240), (575, 238), (574, 238), (572, 240), (570, 240), (569, 241), (569, 242), (568, 243), (560, 243), (560, 245), (559, 246), (558, 246), (557, 247), (556, 247), (555, 248), (555, 249), (557, 251), (558, 251), (559, 252), (561, 252), (562, 253), (563, 253), (564, 254), (567, 254), (568, 253), (569, 253), (570, 254), (575, 254), (576, 255), (578, 255), (579, 256), (579, 257), (580, 257), (580, 256), (579, 255), (580, 254), (589, 254), (588, 254), (587, 253), (588, 252), (590, 252), (591, 253), (592, 252), (594, 252), (595, 253), (597, 253), (598, 254), (603, 254), (604, 253), (603, 252), (604, 251), (605, 251), (606, 250), (609, 250), (610, 251), (617, 251), (618, 252), (620, 252), (621, 253), (623, 251), (624, 251), (625, 252), (630, 252), (629, 251), (628, 251), (627, 250), (627, 247), (628, 246), (629, 247), (631, 247), (631, 246), (630, 245), (629, 245), (628, 244), (629, 243), (630, 243), (629, 242), (630, 241), (632, 241), (632, 239), (634, 237), (636, 237), (635, 236), (635, 235), (632, 235), (631, 234), (625, 234), (624, 233), (621, 233), (620, 232), (622, 230), (623, 230), (624, 231), (624, 228), (625, 227), (625, 226), (626, 225)],
    # # # [(1058, 192), (1057, 193), (1055, 193), (1055, 196), (1056, 196), (1058, 198), (1057, 199), (1056, 199), (1055, 198), (1050, 198), (1050, 199), (1049, 200), (1048, 200), (1048, 202), (1047, 203), (1048, 203), (1049, 204), (1048, 205), (1046, 205), (1048, 205), (1049, 206), (1049, 207), (1050, 206), (1051, 207), (1052, 207), (1053, 208), (1053, 209), (1054, 209), (1055, 210), (1054, 211), (1057, 214), (1058, 213), (1059, 214), (1061, 214), (1063, 216), (1063, 217), (1064, 217), (1065, 218), (1065, 220), (1066, 221), (1066, 219), (1067, 218), (1067, 217), (1069, 215), (1068, 214), (1068, 212), (1069, 211), (1069, 210), (1068, 209), (1068, 208), (1066, 208), (1064, 206), (1064, 205), (1065, 204), (1065, 201), (1062, 198), (1062, 197), (1061, 196), (1060, 197), (1059, 197), (1058, 196), (1059, 195), (1058, 195), (1057, 194), (1058, 193), (1059, 193)] , 
    # [(1059, 194), (1059, 195), (1057, 197), (1055, 197), (1054, 198), (1054, 200), (1053, 201), (1052, 200), (1052, 201), (1053, 202), (1053, 203), (1054, 204), (1054, 205), (1055, 206), (1055, 207), (1056, 207), (1058, 209), (1058, 210), (1059, 210), (1060, 211), (1060, 215), (1059, 216), (1061, 218), (1060, 219), (1060, 220), (1061, 220), (1063, 222), (1063, 225), (1064, 226), (1064, 227), (1063, 228), (1064, 228), (1065, 229), (1066, 229), (1067, 228), (1068, 229), (1069, 229), (1070, 228), (1071, 228), (1073, 230), (1073, 231), (1074, 231), (1075, 232), (1074, 233), (1072, 233), (1071, 232), (1070, 232), (1071, 233), (1071, 235), (1071, 234), (1072, 233), (1074, 235), (1074, 236), (1073, 237), (1073, 241), (1072, 242), (1073, 243), (1073, 244), (1072, 245), (1072, 247), (1073, 246), (1073, 245), (1074, 244), (1074, 241), (1073, 240), (1074, 239), (1075, 239), (1075, 238), (1076, 237), (1077, 237), (1078, 236), (1079, 236), (1080, 235), (1081, 236), (1082, 235), (1084, 235), (1086, 237), (1085, 238), (1087, 238), (1088, 237), (1089, 238), (1090, 238), (1091, 239), (1091, 243), (1092, 242), (1093, 243), (1095, 241), (1095, 240), (1094, 239), (1094, 237), (1091, 237), (1090, 236), (1089, 236), (1087, 234), (1087, 230), (1085, 230), (1084, 229), (1083, 229), (1081, 227), (1081, 226), (1081, 228), (1080, 229), (1079, 229), (1078, 228), (1077, 228), (1076, 227), (1076, 218), (1075, 217), (1075, 214), (1073, 214), (1072, 213), (1072, 212), (1071, 211), (1071, 209), (1068, 206), (1068, 205), (1067, 205), (1065, 203), (1065, 200), (1064, 200), (1062, 198), (1062, 197), (1061, 196), (1061, 195), (1060, 196), (1059, 195)] , 
    # [(350, 323), (349, 324), (344, 324), (343, 325), (342, 325), (340, 327), (339, 327), (338, 328), (336, 328), (336, 329), (335, 330), (334, 330), (334, 331), (333, 332), (329, 332), (327, 334), (326, 334), (325, 335), (324, 335), (324, 336), (323, 337), (322, 336), (320, 336), (319, 335), (319, 333), (317, 333), (317, 334), (316, 335), (315, 335), (314, 334), (314, 333), (313, 334), (312, 334), (312, 335), (313, 336), (315, 336), (316, 337), (316, 339), (315, 340), (313, 340), (312, 341), (311, 341), (310, 340), (310, 341), (307, 344), (303, 344), (303, 345), (302, 346), (301, 346), (299, 348), (298, 348), (297, 349), (296, 349), (296, 351), (295, 352), (294, 352), (294, 353), (293, 354), (292, 354), (289, 357), (288, 356), (287, 356), (286, 355), (286, 354), (286, 355), (285, 356), (282, 356), (282, 358), (281, 359), (281, 360), (280, 361), (279, 361), (280, 362), (281, 362), (282, 363), (283, 363), (284, 364), (285, 363), (284, 362), (285, 361), (286, 361), (289, 358), (290, 359), (290, 362), (289, 363), (289, 365), (288, 366), (286, 366), (286, 368), (287, 368), (288, 369), (286, 371), (286, 373), (288, 371), (288, 370), (289, 369), (288, 368), (290, 366), (291, 367), (291, 371), (291, 370), (292, 369), (292, 365), (293, 364), (293, 363), (294, 362), (296, 362), (297, 361), (297, 360), (298, 359), (299, 360), (304, 360), (305, 359), (307, 359), (308, 360), (311, 357), (312, 358), (312, 357), (315, 354), (316, 354), (318, 352), (319, 352), (321, 350), (323, 350), (324, 349), (325, 349), (325, 346), (326, 345), (328, 345), (329, 346), (328, 347), (330, 347), (332, 345), (335, 345), (337, 343), (340, 343), (342, 341), (344, 341), (345, 340), (346, 340), (347, 339), (349, 339), (348, 339), (347, 338), (348, 337), (348, 335), (349, 334), (350, 334), (350, 332), (349, 332), (348, 331), (350, 329), (350, 327), (351, 326), (351, 324)]]


    coordinates.extend([[(1949.6727785338285, 449.9208797921052),
(1947.7514668091565, 453.23950913472055),
(1945.6554903822414, 455.5101502638785),
(1944.258172764298, 456.90746788182173),
(1943.0355198485977, 458.8287796064938),
(1941.8128669328974, 461.09942073565173),
(1941.4635375284115, 462.84606775808084),
(1945.8301550844844, 462.84606775808084),
(1948.1007962136423, 462.6714030558379),
(1950.3714373428002, 462.6714030558379),
(1950.8954314495288, 461.09942073565173),
(1951.5940902585005, 459.52743841546544),
(1953.3407372809297, 456.90746788182173),
(1954.2140607921442, 454.63682675266386),
(1955.0873843033587, 452.89017973023476),
(1952.642078471958, 451.14353270780555),
(1949.6727785338285, 449.2222209831335),
(1948.1007962136423, 447.6502386629473)], [(1982.6844072577392, 389.4868928160568),
(1984.955048386897, 385.29493996222686),
(1987.051024813812, 380.928322406154),
(1988.6230071339983, 376.3870401478382),
(1989.6709953474558, 371.3217637827937),
(1991.417642369885, 369.9244461648504),
(1992.6402952855854, 372.719081400737),
(1993.5136187968, 375.6883813388666),
(1994.3869423080146, 377.7843577657816),
(1995.0856011169863, 379.35634008596776),
(1996.3082540326866, 381.80164591736855),
(1996.8322481394152, 383.5482929397977),
(1995.9589246282007, 384.945610557741),
(1994.9109364147432, 386.34292817568434),
(1993.5136187968, 388.43890460259934),
(1992.9896246900712, 389.3122281138139),
(1992.1163011788567, 389.8362222205426),
(1990.0203247519416, 389.8362222205426),
(1988.0990130272696, 389.4868928160568),
(1985.6537071958687, 389.3122281138139),
(1983.557730768954, 389.3122281138139)]])
    
    coordinates.extend([
        [(2016, 526), (2016, 527), (2015, 528), (2014, 528), (2014, 529), (2013, 530), (2013, 532), (2011, 534), (2011, 539), (2010, 540), (2010, 543), (2009, 544), (2009, 546), (2008, 547), (2008, 554), (2009, 555), (2010, 554), (2011, 554), (2011, 553), (2012, 552), (2013, 552), (2015, 554), (2016, 554), (2017, 553), (2019, 553), (2020, 554), (2019, 555), (2019, 556), (2020, 557), (2020, 556), (2021, 555), (2021, 554), (2022, 553), (2024, 555), (2024, 554), (2025, 553), (2026, 553), (2026, 552), (2027, 551), (2028, 551), (2030, 549), (2031, 549), (2032, 548), (2031, 548), (2029, 546), (2029, 545), (2028, 544), (2028, 542), (2027, 541), (2026, 541), (2025, 540), (2025, 538), (2026, 537), (2026, 535), (2025, 534), (2026, 533), (2026, 532), (2027, 531), (2026, 530), (2025, 530), (2024, 529), (2025, 528), (2026, 528), (2024, 528), (2023, 527), (2024, 526), (2021, 526), (2020, 527), (2019, 527), (2019, 528), (2018, 529), (2017, 528), (2017, 527)] , 
        [(1778, 222), (1778, 223), (1780, 225), (1780, 230), (1779, 231), (1779, 232), (1781, 234), (1781, 236), (1782, 237), (1782, 238), (1783, 239), (1783, 240), (1784, 241), (1784, 243), (1783, 244), (1784, 244), (1788, 248), (1787, 249), (1787, 250), (1786, 251), (1786, 254), (1787, 255), (1787, 258), (1788, 258), (1789, 259), (1788, 260), (1790, 262), (1790, 264), (1793, 267), (1793, 269), (1794, 269), (1795, 270), (1795, 271), (1794, 272), (1793, 271), (1791, 271), (1791, 272), (1792, 272), (1793, 273), (1793, 274), (1796, 274), (1797, 275), (1798, 275), (1799, 276), (1799, 275), (1800, 274), (1800, 273), (1802, 271), (1803, 271), (1804, 272), (1806, 272), (1808, 274), (1809, 274), (1811, 276), (1811, 277), (1814, 280), (1815, 280), (1816, 281), (1820, 281), (1821, 282), (1823, 282), (1823, 280), (1824, 279), (1825, 279), (1825, 278), (1827, 276), (1828, 277), (1828, 274), (1829, 273), (1830, 274), (1832, 272), (1832, 270), (1834, 268), (1832, 266), (1832, 264), (1833, 263), (1835, 263), (1835, 262), (1833, 260), (1829, 260), (1828, 259), (1828, 258), (1827, 257), (1827, 254), (1826, 253), (1829, 250), (1830, 251), (1830, 250), (1831, 249), (1833, 249), (1832, 248), (1832, 246), (1830, 244), (1830, 243), (1829, 243), (1828, 242), (1827, 242), (1826, 241), (1827, 240), (1826, 239), (1826, 238), (1824, 236), (1825, 235), (1825, 234), (1824, 233), (1824, 232), (1825, 231), (1825, 230), (1826, 229), (1827, 229), (1828, 230), (1828, 231), (1829, 231), (1829, 230), (1830, 229), (1830, 228), (1829, 227), (1826, 227), (1825, 226), (1825, 224), (1824, 225), (1821, 225), (1820, 224), (1819, 225), (1818, 225), (1817, 226), (1814, 226), (1813, 225), (1812, 225), (1811, 226), (1810, 225), (1808, 225), (1807, 224), (1807, 223), (1805, 223), (1804, 222), (1802, 222), (1801, 223), (1800, 222), (1799, 222), (1798, 223), (1797, 223), (1796, 224), (1795, 223), (1794, 223), (1793, 224), (1788, 224), (1787, 223), (1786, 223), (1785, 222), (1784, 223), (1780, 223), (1779, 222)] , 
        [(381, 64), (381, 65), (382, 66), (382, 67), (383, 68), (383, 69), (380, 72), (379, 72), (379, 74), (377, 76), (376, 76), (375, 77), (373, 75), (372, 75), (372, 77), (371, 78), (369, 76), (369, 75), (366, 72), (367, 71), (365, 71), (365, 73), (363, 75), (362, 75), (362, 79), (361, 80), (361, 84), (362, 85), (362, 86), (363, 87), (364, 87), (365, 88), (365, 90), (363, 92), (363, 93), (362, 94), (362, 97), (363, 98), (362, 99), (362, 101), (360, 103), (360, 105), (361, 106), (361, 107), (362, 108), (362, 110), (363, 111), (364, 111), (366, 113), (366, 114), (367, 113), (368, 114), (368, 115), (369, 116), (371, 116), (371, 115), (372, 114), (373, 114), (373, 113), (374, 112), (377, 112), (378, 113), (378, 114), (379, 115), (380, 114), (381, 114), (382, 113), (382, 112), (381, 111), (381, 110), (382, 109), (384, 111), (384, 113), (385, 112), (386, 112), (387, 111), (387, 108), (388, 107), (388, 106), (390, 104), (392, 104), (395, 101), (396, 101), (396, 97), (397, 96), (397, 93), (403, 87), (403, 86), (402, 86), (402, 87), (401, 88), (399, 88), (398, 87), (398, 84), (399, 83), (399, 80), (400, 79), (399, 79), (396, 76), (397, 75), (395, 75), (393, 73), (390, 73), (389, 72), (389, 69), (388, 70), (387, 69), (386, 69), (384, 67), (383, 67), (382, 66), (382, 64)] , 
        [(343, 0), (343, 3), (344, 2), (345, 2), (346, 3), (346, 4), (345, 5), (345, 6), (344, 7), (344, 11), (345, 12), (345, 14), (346, 15), (346, 20), (347, 20), (348, 21), (349, 20), (351, 20), (352, 19), (354, 19), (355, 18), (357, 18), (360, 15), (361, 15), (362, 14), (362, 13), (363, 12), (363, 8), (362, 7), (363, 6), (363, 4), (364, 3), (364, 0)]
    ])
    
    coordinates = coordinates[:regionsNumber]
    # coordinates = []

    hulls = [ConvexHull(coord) for coord in coordinates]
    regions = []*len(hulls)
    for i in range(len(hulls)):
        regions.append([coordinates[i][s] for s in hulls[i].vertices])
        regions[i].append(regions[i][0])


    interpolated_regions = []
    for region in regions:
        interpolated_region_x = []
        interpolated_region_y = []
        for i in range(len(region) - 1):
            flag = False
            x1, y1 = region[i]
            x2, y2 = region[i+1]
            if x1 > x2:
                x1, y1, x2, y2 = x2, y2, x1, y1
                flag = True
            f = interp1d([x1, x2], [y1, y2])
            interpolated_x = np.arange(x1, x2, 0.01)
            interpolated_y = f(interpolated_x)
            if flag:
                interpolated_x = interpolated_x[::-1]
                interpolated_y = interpolated_y[::-1]
            interpolated_region_x.extend(interpolated_x)
            interpolated_region_y.extend(interpolated_y)

        interpolated_regions.append([interpolated_region_x, interpolated_region_y])

    for i, region in enumerate(interpolated_regions):
        P_classes = generate_probabilities()
        P_classes = [0, 0, 0, 0.2, 0.8, 0, 0, 0, 0, 0]
        p_untraversable = sum([P_classes[i] for i in semantic_untraversable_class_list])
                  # [0,    2,   3,        5, 6, 7, 8]
        contour_object = Contour(region, i,  P_classes = P_classes, p_untraversable=p_untraversable)
        contours_objects.append(contour_object)



    semantic_classes = img
    geometric_classes = pickle.load(open(r'results/mask_final.pickle', 'rb'))

    final_traversability_classes = geometric_classes.copy()

    # if value of pixel a value from the untraversable classes, then it is an obstacle
    mask_obstacle = np.isin(semantic_classes, semantic_untraversable_class_list)
    final_traversability_classes[mask_obstacle.data] = 0
    final_num_classes = len(gdls_classes_cost)

    WIDTH = final_traversability_classes.shape[1]
    HEIGHT = final_traversability_classes.shape[0]
    cost_map = np.zeros((WIDTH, HEIGHT))
    obstacle_list = []
    for x in range(WIDTH):
        for y in range(HEIGHT):
            if math.isnan(final_traversability_classes[y,x]):
                final_traversability_classes[y,x] = 1
            if final_traversability_classes[y,x] in final_untraversable_class_list:
                obstacle_list.append((x,y))
            cost_map[x,y] = gdls_classes_cost[int(final_traversability_classes[y,x])]
    # plt.imshow(final_traversability_classes, cmap='gray')
    # plt.show()
    for contour_object in contours_objects:
        P_classes = contour_object.P_classes
        new_P_classes = [0]* final_num_classes 
        p_untraversable = sum([P_classes[i] for i in semantic_untraversable_class_list])
        new_P_classes[0] = p_untraversable
        # set the rest randomly, but make sure they sum to 1
        for i in range(1, final_num_classes):
            new_P_classes[i] = np.random.random()
        traversable_sum = sum(new_P_classes[1:])
        for i in range(1, final_num_classes):
            new_P_classes[i] = (new_P_classes[i] / traversable_sum) * (1 - p_untraversable)
        contour_object.P_classes = new_P_classes
        final_traversability_classes, cost_map = update_map(cost_map, img = final_traversability_classes, contour_object = contour_object)



    return final_traversability_classes, cost_map, contours_objects, obstacle_list

def update_map(mHat, img  = [], contour_object = None, index = -1):
    # change the value of the points inside to the region to be one of the classes
    # choose the class with the probability in the list P_classes
    numOfClasses = len(np.unique(img))
    numOfClasses = 4
    traversable_probabilities = contour_object.P_classes[1:].copy()
    traversable_probabilities = np.divide(traversable_probabilities, sum(traversable_probabilities))
    if index == -1:
        index = np.random.choice(range(1,numOfClasses), p=traversable_probabilities)

    # cost is the weighted sum of the probabilities of the traversable classes and the cost of the classes
    cost = sum([contour_object.P_classes[i] * gdls_classes_cost[i] for i in range(1, numOfClasses)])
    cost = cost / (1- contour_object.P_classes[0])

    for point in contour_object.map_points_inside:
        mHat[point[0], point[1]] = cost      
        if img is not None:
            img[point[1], point[0]] = index
    return img, mHat

def generate_probabilities(numOfClasses = None):

    if numOfClasses is None:
        numOfClasses = params["numOfClasses"]

    # Generate initial random probabilities
    probs = np.random.rand(numOfClasses)
    
    # Normalize to sum to 1
    probs = probs / probs.sum()
    
    # Adjust probabilities to ensure each is less than p_certain
    while np.any(probs >= p_certain):
        excess_prob = np.sum(probs[probs >= p_certain] - p_certain)
        probs[probs >= p_certain] = p_certain
        probs[probs < p_certain] += excess_prob / np.sum(probs < p_certain)
    # print(probs, probs.sum())
    return probs

params = param_loader()
HEIGHT = params["HEIGHT"]
WIDTH = params["WIDTH"]
robot_size = params["robot_size"]
p_certain = params["p_certain"]
semantic_untraversable_class_list = params["semantic_untraversable_class_list"]
final_untraversable_class_list = params["final_untraversable_class_list"]
gdls_classes_cost = params["gdls_classes_cost"]

if __name__ == '__main__':
    # current_dir = os.path.dirname(os.path.abspath(__file__))
    
    # yaml_path = os.path.join(current_dir, 'config', 'config.yaml')
    # map_loader(yaml_path)
    img, contours_objects = get_GDLS_map(scale=1)
    plt.imshow(img, cmap='gray')
    plt.show()
